{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"MPP Guide Multi-Physics Problem (MPP) library is a standalone library that solves biophysics problems relevant to global land surface models (LSMs). This technical guide summarizes the recently developed Multi-Layer Canopy Model in the MPP library.","title":"Home"},{"location":"#mpp-guide","text":"Multi-Physics Problem (MPP) library is a standalone library that solves biophysics problems relevant to global land surface models (LSMs). This technical guide summarizes the recently developed Multi-Layer Canopy Model in the MPP library.","title":"MPP Guide"},{"location":"tech_guide/overview/","text":"Overview The Multi-Physics Problem Library is a standalone numerical libary that includes support for the following physics: Variably saturated transport of water in soil, Tranpsort of heat in soil column and snow layers, and Multi-layer canopy model","title":"Overview"},{"location":"tech_guide/overview/#overview","text":"The Multi-Physics Problem Library is a standalone numerical libary that includes support for the following physics: Variably saturated transport of water in soil, Tranpsort of heat in soil column and snow layers, and Multi-layer canopy model","title":"Overview"},{"location":"tech_guide/mlc/canopy_profile/","text":"The leaf area density (LAD), \\(a(z)\\) [m \\(^2\\) m \\(^{-3}\\) ], at height \\(z\\) are given by a beta distribution as \\[\\begin{equation} a(z) = \\left(\\frac{L}{h_c}\\right) \\left( \\frac{ (z/h_c)^{p-1} (1 - (z/h_c)^{q-1})}{B(p,q)}\\right) \\end{equation}\\] where \\(p\\) and \\(q\\) are the shape function of the beta distribution, \\(B(p,q)\\) is a normalization constant, \\(h_c\\) is the canopy height. The total leaf area index (LAI), \\(L\\) [m \\(^2\\) m \\(^{-2}\\) ] and the cumulative leaf area index, \\(L(z)\\) [m \\(^2\\) m \\(^{-2}\\) ], from the top of the canopy is given as \\[\\begin{align} L &=& \\int_0^{h_c} a(z) dz \\\\ L(z) &=& \\int_z^{h_c} a(z) dz \\end{align}\\] The stem area density (SAD) is also similarly modeled by a beta distribution. The plant area density (PAD) is the sum of LAD and SAD.","title":"Canopy profile"},{"location":"tech_guide/mlc/leaf_boundary_layer_model/","text":"The boundary conductance controls the transfer of heat and mass (both, H \\(_2\\) O and CO \\(_2\\) ) from the leaf surface to the surrounding air. The Nusslet number, \\(Nu\\) [-], is the ratio of convective to conductive heat transfer, while the Sherwood number, \\(Sh\\) [-], is the ratio of convective to conductive mass transfer that are given by \\[\\begin{eqnarray} \\label{eqn_definitation_of_numbers} \\text{Nu} &=& \\frac{g_{bh}d_\\ell}{\\rho_m D_h} \\\\[0.2em] \\text{Sh}_w &=& \\frac{g_{bw}d_\\ell}{\\rho_m D_w} \\\\[0.2em] \\text{Sh}_c &=& \\frac{g_{bc}d_\\ell}{\\rho_m D_c} \\end{eqnarray}\\] where \\(g_{bh}\\) [mol m \\(^{-2}_{leaf}\\) s \\(^{-1}\\) ] is boundary conductance for heat , \\(g_{bv}\\) [mol m \\(^{-2}_{leaf}\\) s \\(^{-1}\\) ] is boundary conductance for H \\(_2\\) O, \\(g_{bc}\\) [mol m \\(^{-2}_{leaf}\\) s \\(^{-1}\\) ] is boundary conductance for CO \\(_2\\) , \\(D_h\\) [m \\(^2\\) s \\(^{-1}\\) ] is the molecular diffusivity for heat, \\(D_w\\) [m \\(^2\\) s \\(^{-1}\\) ] is the molecular diffusivity for H \\(_2\\) O, \\(D_c\\) [m \\(^2\\) s \\(^{-1}\\) ] is the molecular diffusivity for CO \\(_2\\) , \\(\\rho_m\\) [mol m \\(^{-3}\\) ] is molar density, \\(d_\\ell\\) [m] is the representative leaf dimension, and \\(\\text{Sh}_w\\) and \\(\\text{Sh}_c\\) are Sherwood number for water vapor and CO \\(_2\\) , respectively. Empirical studies have developed relationship for \\(\\text{Nu}\\) , \\(\\text{Sh}_w\\) , and \\(\\text{Sh}_c\\) for laminar flow: \\[\\begin{eqnarray} \\text{Nu}^{Laminar} &=& b_1 0.66 \\text{Pr} ^{0.33}Re^{0.5} \\\\[0.4em] \\text{Sh}_w^{Laminar} &=& b_1 0.66 \\text{Sc}_w^{0.33}Re^{0.5} \\\\[0.4em] \\text{Sh}_c^{Laminar} &=& b_1 0.66 \\text{Sc}_c^{0.33}Re^{0.5} \\end{eqnarray}\\] and turbulent flow: \\[\\begin{eqnarray} \\text{Nu}^{Turbulent} &=& b_1 0.036\\text{Pr} ^{0.33}Re^{0.8} \\\\[0.4em] \\text{Sh}_w^{Turbulent} &=& b_1 0.036\\text{Sc}_w^{0.33}Re^{0.8} \\\\[0.4em] \\text{Sh}_c^{Turbulent} &=& b_1 0.036\\text{Sc}_c^{0.33}Re^{0.8} \\end{eqnarray}\\] where \\(\\text{Re}\\) [-] is the Reynolds number that is a ratio of inertial forces to viscous forces, \\(\\text{Pr}\\) [-] is the Prandtl number that is a ratio of diffusivity of momentum to diffusivity of heat in fluid, \\(\\text{Sc}_w\\) [-] and \\(\\text{Sc}_c\\) [-] are the Schmidt numbers that are ratio of diffusivity of momentum to diffusivity of mass for H \\(_2\\) O and CO \\(_2\\) ) in fluid, respectively, and \\(b_1 = 1.5\\) is a typical value that converts the empirical relationship developed for a flat rectangular plate to for leaves. The Prandtl, Reynolds, and Schmidt numbers are \\[\\begin{eqnarray} \\text{Re} &=& \\frac{u d_\\ell}{\\nu} \\\\[0.4em] \\text{Pr} &=& \\frac{\\nu}{D_h}\\\\[0.4em] \\text{Sc}_w &=& \\frac{\\nu}{D_w} \\\\[0.4em] \\text{Sc}_c &=& \\frac{\\nu}{D_c} \\end{eqnarray}\\] where \\(\\nu\\) [m \\(^2\\) s \\(^{-1}\\) ] is the kinematic viscosity. The forced flow due to laminar and turbulent flow is given as \\[\\begin{eqnarray} \\text{Nu} ^{forced} &=& \\max(\\text{Nu}^{Laminar}, \\text{Nu} ^{Turbulen}) \\\\[0.4em] \\text{Sh}_w^{forced} &=& \\max(Shv^{Laminar}, \\text{Sh}_w^{Turbulent}) \\\\[0.4em] \\text{Sh}_c^{forced} &=& \\max(Shc^{Laminar}, \\text{Sh}_c^{Turbulent}) \\end{eqnarray}\\] In free convection, The Nusselt and Scherwood number are described in terms of Grashof number, \\(\\text{Gr}\\) [-], as \\[\\begin{eqnarray} \\text{Nu}^{Free} &=& 0.54\\text{Pr} ^{0.25}\\text{Gr}^{0.25} \\\\[0.4em] \\text{Sh}_w^{Free} &=& 0.54\\text{Sc}_c^{0.25}\\text{Gr}^{0.25} \\\\[0.4em] \\text{Sh}_c^{Free} &=& 0.54\\text{Sc}_c^{0.25}\\text{Gr}^{0.25} \\\\[0.4em] \\end{eqnarray}\\] The Grashof number is given as \\[\\begin{equation} \\text{Gr} = \\frac{gd_\\ell^3 (T_\\ell - T_a)}{\\nu^2 T_a} \\end{equation}\\] where \\(g\\) [m s \\(^{-2}\\) ] is the gravitational acceleration, \\(T_\\ell\\) [K] is the leaf temperature, and \\(T_a\\) [K] is the air temperature. Lastly, the combined Nusselt and Scherwood number for forced and free flow are given as \\[\\begin{eqnarray} \\label{eqn_combined_numbers} \\text{Nu} &=& \\text{Nu} ^{Forced} + \\text{Nu} ^{free} \\\\[0.4em] \\text{Sh}_w &=& \\text{Sh}_w^{Forced} + \\text{Sh}_w^{free} \\\\[0.4em] \\text{Sh}_c &=& \\text{Sh}_c^{Forced} + \\text{Sh}_c^{free} \\end{eqnarray}\\] The leaf boundary conductances for heat, H \\(_2\\) O, and CO \\(_2\\) are given by combining equations \\eqref{eqn_definitation_of_numbers} and \\eqref{eqn_combined_numbers} \\[\\begin{eqnarray} g_{bh} &=& \\frac{D_h \\times \\text{Nu}}{d_\\ell} \\rho_m\\\\[0.4em] g_{bw} &=& \\frac{D_w \\times Sh_v}{d_\\ell} \\rho_m\\\\[0.4em] g_{bc} &=& \\frac{D_c \\times Sh_c}{d_\\ell} \\rho_m \\end{eqnarray}\\] The kinematic viscosity and molecular diffusivities are adjusted to account for air temperature and air pressure, \\(P_a\\) [Pa], as \\[\\begin{eqnarray} \\nu &=& f \\times \\nu_0 \\\\ D_h &=& f \\times Dh_0 \\\\ D_w &=& f \\times Dv_0 \\\\ D_c &=& f \\times Dc_0 \\\\ f &=& \\frac{10325}{P_{a}}\\times \\left(\\frac{T_a}{272.15}\\right)^{1.81} \\end{eqnarray}\\] where \\(\\nu_0\\) is kinematic viscosity at 0 \\(^0\\) C, and \\(Dh_0\\) , \\(Dv_0\\) , \\(Dc_0\\) are molecular diffusivity for heat, H \\(_2\\) O, and CO \\(_2\\) at 0 \\(^0\\) C.","title":"Leaf boundary layer model"},{"location":"tech_guide/mlc/longwave_radiation/","text":"Governing equations The downwelling, \\(L_{i}^\\downarrow\\) [Wm \\(^{-2}\\) ], and upwelling \\(L_{i+1}^\\uparrow\\) [Wm \\(^{-2}\\) ], longwave radiation can be similarly described as the shortwave radiation model by replacing the direct beam scattering term with a thermal radiation source term as \\[\\begin{eqnarray} L_{i }^{\\downarrow} & = & L_{i+1 }^{\\downarrow} \\left[ \\mathcal{\\tau}_{d,i+1} + (1 - \\tau_{d,i+1})\\tau_{\\ell,i+1}\\right] + L_{i }^{\\uparrow} (1 - \\tau_{d,i+1})\\rho_{\\ell,i+1} \\nonumber \\\\ & & + \\varepsilon_\\ell \\sigma T_{\\ell,i+1}^4 (1 - \\tau_{d,i+1}) \\\\ L_{i+1}^{\\uparrow} & = & L_{i }^{\\uparrow} \\left[ \\tau_{d,i+1} + (1 - \\tau_{d,i+1})\\tau_{\\ell,i+1}\\right] + L_{i+1 }^{\\downarrow} (1 - \\tau_{d,i+1})\\rho_{\\ell,i+1} \\nonumber \\\\ & & + \\varepsilon_\\ell \\sigma T_{\\ell,i+1}^4 (1 - \\tau_{d,i+1}) \\end{eqnarray}\\] where \\(\\varepsilon_{\\ell}\\) [-] is the leaf emissivity and \\(T_\\ell\\) [K] is the leaf temperature. If sunlit and shaded leaves are modeled explicitly, an effective leaf temperature is defined based on the sunlit and shaded leaf fraction. Linear system The linear system of equations for the longwave model can be written as \\[\\begin{align} \\begin{bmatrix} 1 & -(1-\\varepsilon_{g}) & & & & & & \\\\[.6em] -a_0 & 1 & -b_0 & & & & & \\\\[.6em] & -e_1 & 1 & -f_1 & & & & \\\\[.6em] & & -a_1 & 1 & -b_1 & & & \\\\[.6em] & & & \\ddots & \\ddots & \\ddots & & \\\\[.6em] & & & & \\ddots & \\ddots & \\ddots & \\\\[.6em] & & & & & -e_N & 1 & -f_N \\\\[.6em] & & & & & & 0 & 1 \\end{bmatrix} \\begin{bmatrix} L_0^\\uparrow \\hspace{5pt} \\\\[.5em] L_0^\\downarrow \\\\[.5em] L_1^\\uparrow \\\\[.5em] L_1^\\downarrow \\\\[.5em] \\vdots \\\\[.5em] \\vdots \\\\[.5em] L_N^\\uparrow \\\\[.5em] L_N^\\downarrow \\end{bmatrix} = \\begin{bmatrix} c_0 \\hspace{5pt} \\\\[.6em] d_0 \\\\[.6em] c_1 \\\\[.6em] d_1 \\\\[.6em] \\vdots \\\\[.6em] \\vdots \\\\[.6em] c_N \\\\[.6em] d_N \\end{bmatrix} \\end{align}\\] where \\[\\begin{eqnarray} a_i &=& f_{i+1} = (1-\\tau_{d,i+1})\\rho_{\\ell,i+1} - \\frac{[\\tau_{d,i+1} + (1 - \\tau_{d,i+1}) \\tau_{\\ell,i+1} ]^2} {(1 - \\tau_{d,i+1})/\\rho_{\\ell,i+1}} \\\\[1em] b_i &=& e_{i+1} = \\frac{\\tau_{d,i+1} + (1 - \\tau_{d,i+1})\\tau_{\\ell,i+1}} {(1 - \\tau_{d,i+1}) \\rho_{\\ell,i+1}} \\\\[1em] c_i &=& (1 - e_i)(1 - \\tau_{d,i }) \\varepsilon_\\ell \\sigma T_{\\ell,i }^4 \\\\[1em] d_i &=& (1 - b_i)(1 - \\tau_{d,i+1}) \\varepsilon_\\ell \\sigma T_{\\ell,i+1}^4 \\end{eqnarray}\\] The boundary conditions for the downwelling radiation at the bottom layer, \\(i=0\\) , and the upwelling radiation at the top layer, \\(i=N\\) , are given as \\[\\begin{eqnarray} c_0 &=& \\varepsilon_{g} \\sigma T_g^4 \\\\ d_N &=& L_{sky}^\\downarrow \\end{eqnarray}\\] where \\(\\varepsilon_g\\) [-] is ground surface emissivity, \\(T_g\\) [K] is the ground surface temperature, and \\(L_{sky}^\\downarrow\\) [Wm \\(^{-2}\\) ] is incident longwave radiation at the top of the canopy. Absorbed fluxes The net longwave flux absorbed per unit ground area, \\(\\overrightarrow{L}_i\\) [Wm \\(_{ground}^{-2}\\) ], and per unit leaf area, \\(\\overrightarrow{L}_{\\ell,i}\\) [Wm \\(_{leaf}^{-2}\\) ], by the \\(i\\) -th layer are \\[\\begin{eqnarray} \\overrightarrow{L}_i &=& \\varepsilon_{\\ell} \\left( L_i^\\downarrow + L_{i-1}^\\uparrow \\right) (1 - \\tau_{d,i}) - 2 \\varepsilon_\\ell \\sigma T_{\\ell,i}^4 (1 - \\tau_{d,i}) \\\\[.2em] \\overrightarrow{L}_{\\ell,i} &=& \\frac{\\overrightarrow{L}_i}{\\Delta L_i} \\end{eqnarray}\\] The radiation absorbed by the canopy, \\(\\overrightarrow{L}_{c}\\) [Wm \\(_{ground}^{-2}\\) ], and the ground, \\(\\overrightarrow{L}_{g}\\) [Wm \\(_{ground}^{-2}\\) ], is given by \\[\\begin{eqnarray} \\overrightarrow{L}_c &=& \\sum_{i=1}^{N} \\overrightarrow{L}_c \\\\[.2em] \\overrightarrow{L}_{g} &=& \\varepsilon_g L_0^\\downarrow - \\varepsilon_g \\sigma T_g^4 \\end{eqnarray}\\]","title":"Longwave radiation"},{"location":"tech_guide/mlc/longwave_radiation/#governing-equations","text":"The downwelling, \\(L_{i}^\\downarrow\\) [Wm \\(^{-2}\\) ], and upwelling \\(L_{i+1}^\\uparrow\\) [Wm \\(^{-2}\\) ], longwave radiation can be similarly described as the shortwave radiation model by replacing the direct beam scattering term with a thermal radiation source term as \\[\\begin{eqnarray} L_{i }^{\\downarrow} & = & L_{i+1 }^{\\downarrow} \\left[ \\mathcal{\\tau}_{d,i+1} + (1 - \\tau_{d,i+1})\\tau_{\\ell,i+1}\\right] + L_{i }^{\\uparrow} (1 - \\tau_{d,i+1})\\rho_{\\ell,i+1} \\nonumber \\\\ & & + \\varepsilon_\\ell \\sigma T_{\\ell,i+1}^4 (1 - \\tau_{d,i+1}) \\\\ L_{i+1}^{\\uparrow} & = & L_{i }^{\\uparrow} \\left[ \\tau_{d,i+1} + (1 - \\tau_{d,i+1})\\tau_{\\ell,i+1}\\right] + L_{i+1 }^{\\downarrow} (1 - \\tau_{d,i+1})\\rho_{\\ell,i+1} \\nonumber \\\\ & & + \\varepsilon_\\ell \\sigma T_{\\ell,i+1}^4 (1 - \\tau_{d,i+1}) \\end{eqnarray}\\] where \\(\\varepsilon_{\\ell}\\) [-] is the leaf emissivity and \\(T_\\ell\\) [K] is the leaf temperature. If sunlit and shaded leaves are modeled explicitly, an effective leaf temperature is defined based on the sunlit and shaded leaf fraction.","title":"Governing equations"},{"location":"tech_guide/mlc/longwave_radiation/#linear-system","text":"The linear system of equations for the longwave model can be written as \\[\\begin{align} \\begin{bmatrix} 1 & -(1-\\varepsilon_{g}) & & & & & & \\\\[.6em] -a_0 & 1 & -b_0 & & & & & \\\\[.6em] & -e_1 & 1 & -f_1 & & & & \\\\[.6em] & & -a_1 & 1 & -b_1 & & & \\\\[.6em] & & & \\ddots & \\ddots & \\ddots & & \\\\[.6em] & & & & \\ddots & \\ddots & \\ddots & \\\\[.6em] & & & & & -e_N & 1 & -f_N \\\\[.6em] & & & & & & 0 & 1 \\end{bmatrix} \\begin{bmatrix} L_0^\\uparrow \\hspace{5pt} \\\\[.5em] L_0^\\downarrow \\\\[.5em] L_1^\\uparrow \\\\[.5em] L_1^\\downarrow \\\\[.5em] \\vdots \\\\[.5em] \\vdots \\\\[.5em] L_N^\\uparrow \\\\[.5em] L_N^\\downarrow \\end{bmatrix} = \\begin{bmatrix} c_0 \\hspace{5pt} \\\\[.6em] d_0 \\\\[.6em] c_1 \\\\[.6em] d_1 \\\\[.6em] \\vdots \\\\[.6em] \\vdots \\\\[.6em] c_N \\\\[.6em] d_N \\end{bmatrix} \\end{align}\\] where \\[\\begin{eqnarray} a_i &=& f_{i+1} = (1-\\tau_{d,i+1})\\rho_{\\ell,i+1} - \\frac{[\\tau_{d,i+1} + (1 - \\tau_{d,i+1}) \\tau_{\\ell,i+1} ]^2} {(1 - \\tau_{d,i+1})/\\rho_{\\ell,i+1}} \\\\[1em] b_i &=& e_{i+1} = \\frac{\\tau_{d,i+1} + (1 - \\tau_{d,i+1})\\tau_{\\ell,i+1}} {(1 - \\tau_{d,i+1}) \\rho_{\\ell,i+1}} \\\\[1em] c_i &=& (1 - e_i)(1 - \\tau_{d,i }) \\varepsilon_\\ell \\sigma T_{\\ell,i }^4 \\\\[1em] d_i &=& (1 - b_i)(1 - \\tau_{d,i+1}) \\varepsilon_\\ell \\sigma T_{\\ell,i+1}^4 \\end{eqnarray}\\] The boundary conditions for the downwelling radiation at the bottom layer, \\(i=0\\) , and the upwelling radiation at the top layer, \\(i=N\\) , are given as \\[\\begin{eqnarray} c_0 &=& \\varepsilon_{g} \\sigma T_g^4 \\\\ d_N &=& L_{sky}^\\downarrow \\end{eqnarray}\\] where \\(\\varepsilon_g\\) [-] is ground surface emissivity, \\(T_g\\) [K] is the ground surface temperature, and \\(L_{sky}^\\downarrow\\) [Wm \\(^{-2}\\) ] is incident longwave radiation at the top of the canopy.","title":"Linear system"},{"location":"tech_guide/mlc/longwave_radiation/#absorbed-fluxes","text":"The net longwave flux absorbed per unit ground area, \\(\\overrightarrow{L}_i\\) [Wm \\(_{ground}^{-2}\\) ], and per unit leaf area, \\(\\overrightarrow{L}_{\\ell,i}\\) [Wm \\(_{leaf}^{-2}\\) ], by the \\(i\\) -th layer are \\[\\begin{eqnarray} \\overrightarrow{L}_i &=& \\varepsilon_{\\ell} \\left( L_i^\\downarrow + L_{i-1}^\\uparrow \\right) (1 - \\tau_{d,i}) - 2 \\varepsilon_\\ell \\sigma T_{\\ell,i}^4 (1 - \\tau_{d,i}) \\\\[.2em] \\overrightarrow{L}_{\\ell,i} &=& \\frac{\\overrightarrow{L}_i}{\\Delta L_i} \\end{eqnarray}\\] The radiation absorbed by the canopy, \\(\\overrightarrow{L}_{c}\\) [Wm \\(_{ground}^{-2}\\) ], and the ground, \\(\\overrightarrow{L}_{g}\\) [Wm \\(_{ground}^{-2}\\) ], is given by \\[\\begin{eqnarray} \\overrightarrow{L}_c &=& \\sum_{i=1}^{N} \\overrightarrow{L}_c \\\\[.2em] \\overrightarrow{L}_{g} &=& \\varepsilon_g L_0^\\downarrow - \\varepsilon_g \\sigma T_g^4 \\end{eqnarray}\\]","title":"Absorbed fluxes"},{"location":"tech_guide/mlc/multi_layer_canopy/","text":"Governing equations The equations for the time evolution of air temperature, \\(\\theta\\) , and water vapor, \\(q\\) , sunlit leaf temperature, \\(T_{\\ell sun}\\) , and shaded leaf temperature, \\(T_{\\ell shd}\\) , in a MLCM is given by \\[\\begin{eqnarray} \\rho_mc_p \\left(\\frac{\\partial\\theta}{\\partial t}\\right) &=& c_p \\nabla \\cdot \\left( g_{a} \\nabla \\theta \\right) + \\frac{Q_{\\theta sun,i} \\Delta L_{sun,i}}{\\Delta z_i} + \\frac{Q_{\\theta shd,i} \\Delta L_{shd,i}}{\\Delta z_i} \\label{eqn_mlc_tair} + S_\\theta \\\\ \\rho_m \\left( \\frac{\\partial q}{\\partial t} \\right) &=& \\nabla \\cdot \\left( g_{a} \\nabla q \\right) + \\frac{Q_{qsun,i} \\Delta L_{sun,i}}{\\Delta z_i} + \\frac{Q_{qshd,i} \\Delta L_{shd,i}}{\\Delta z_i} \\label{eqn_mlc_qair} + S_q \\\\ c_{\\ell} \\left( \\frac{\\partial T_{\\ell sun}}{\\partial t} \\right) &=& \\text{R}_{n,sun} - Q_{\\theta sun} - \\lambda Q_{qsun} + S_{\\ell sun} \\label{eqn_mlc_tsun} \\\\ c_{\\ell} \\left( \\frac{\\partial T_{\\ell shd}}{\\partial t} \\right) &=& \\text{R}_{n,shd} - Q_{\\theta shd} - \\lambda Q_{qshd} + S_{\\ell shd} \\label{eqn_mlc_tshd} \\end{eqnarray}\\] where \\(\\rho_m\\) is density of air, \\(\\lambda\\) is latent heat of vaporization for water, \\(c_p\\) is specific heat capacity of air, \\(c_{\\ell}\\) is specific heat capacity of leaf, \\(g_{a}\\) is atmospheric conductance, \\(\\Delta L_{sun}\\) is the leaf area index of the sunlit leaf, \\(\\Delta L_{shd}\\) is the leaf area index of the shaded leaf, \\(Q_{\\theta sun}\\) is the heat source from the sunlit leaf to the canopy air, \\(Q_{\\theta shd}\\) is the heat source from the shaded leaf to the canopy air, \\(Q_{qsun}\\) is the water vapor source from the sunlit leaf the canopy air, \\(Q_{qsun}\\) is the water vapor source from the shaded leaf the canopy air, \\(\\text{Rn}_{sun}\\) is the net shortwave and longwave radiation absorbed by the sunlit leaf, and \\(\\text{Rn}_{shd}\\) is the net shortwave and longwave radiation absorbed by the shaded leaf. The source of heat and water vapor for sunlit and shaded leaves at the \\(i\\) -th layer are given by \\[\\begin{eqnarray} Q_{\\theta sun} &=& 2c_p(T_{\\ell sun} - \\theta_i)g_{bh} \\\\ Q_{\\theta shd} &=& 2c_p(T_{\\ell shd} - \\theta_i)g_{bh}\\\\ Q_{qsun} &=& (q_{sat}(T_{\\ell sun}) - q_i) g_{\\ell sun} \\\\ Q_{qshd} &=& (q_{sat}(T_{\\ell shd}) - q_i) g_{\\ell shd} \\end{eqnarray}\\] where \\(g_{bh,i}\\) is the boundary layer conductance for heat, \\(g_{bw,i}\\) is the boundary layer conductance for water vapor, \\(g_{\\ell sun,i}\\) is the total leaf conductance for the sunlit leaf, and \\(g_{\\ell shd,i}\\) is the total leaf conductance for the shaded leaf. The leaf conductances are given as \\[\\begin{eqnarray} g_{\\ell sun} &=& \\left(\\frac{1}{g_{bw}^{-1} + g_{sw,sun}^{-1}}\\right) f_{dry} + g_{bw} f_{wet}\\\\ g_{\\ell shd} &=& \\left(\\frac{1}{g_{bw}^{-1} + g_{sw,shd}^{-1}}\\right) f_{dry} + g_{bw} f_{wet} \\end{eqnarray}\\] where \\(g_{sw,sun}\\) is the stomatal conductance for the sunlit leaf, and \\(g_{sw,shd}\\) is the stomatal conductance for the shaded leaf. The net radiation absorbed by sunlit and shaded leaf are given by \\[\\begin{eqnarray} \\label{eqn_rn} \\text{Rn}_{sun} &=& \\vec{I}^{d}_{sun} + \\vec{I}^{b}_{sun} + \\vec{L}_{sun}\\\\ \\text{Rn}_{shd} &=& \\vec{I}^{d}_{shd} + \\vec{L}_{shd} \\label{eqn:net_} \\end{eqnarray}\\] where \\(\\vec{I}^{d}\\) is absorbed diffuse radiation, \\(\\vec{I}^{b}\\) is absorbed beam radiation, and \\(\\vec{L}\\) is absorbed longwave radiation. The finite volume and implicit time discretization of equation \\eqref{eqn_mlc_tair}-\\eqref{eqn_mlc_tshd} leads to the following equations for the \\(i\\) -th layer can be written as \\[\\begin{eqnarray} \\begin{bmatrix} \\alpha_{1,1} & {\\alpha_{1,2}} & {\\alpha_{1,3}} & \\alpha_{1,4} & \\alpha_{1,5} & \\alpha_{0,6} & {\\alpha_{1,7}} & {\\alpha_{1,8}}\\\\ 0 & 0 & 0 & {\\alpha_{2,4}} & {\\alpha_{2,5}} & {\\alpha_{2,6}} & {\\alpha_{2,7}} & {\\alpha_{2,8}}\\\\ 0 & {\\alpha_{3,2}} & 0 & 0 & {\\alpha_{3,5}} & 0 & {\\alpha_{3,7}} & 0 \\\\ 0 & {\\alpha_{4,2}} & 0 & 0 & {\\alpha_{4,5}} & 0 & 0 & {\\alpha_{4,8}}\\\\ \\end{bmatrix} \\begin{bmatrix} \\theta_{i-1}^{t+1} \\\\ \\theta_{i }^{t+1} \\\\ \\theta_{i+1}^{t+1} \\\\ q_{i-1}^{t+1} \\\\ q_{i }^{t+1} \\\\ q_{i+1}^{t+1} \\\\ T_{lsun,i}^{t+1} \\\\ T_{lshd,i}^{t+1} \\end{bmatrix} = \\begin{bmatrix} \\beta_{1} \\\\ \\beta_{2} \\\\ \\beta_{3} \\\\ \\beta_{4} \\end{bmatrix} \\label{eqn_mlc_matrix} \\end{eqnarray}\\] Air temperature equation The discretized equation \\ref{eqn_mlc_tair} at an internal vertical layer (i.e. \\(0<i<N\\) ) \\[\\begin{eqnarray} \\frac{\\rho_m }{\\Delta t} \\left(\\theta_i^{t+1} - \\theta_i^{t}\\right) &=& + g_{a,i+\\frac{1}{2}} \\left(\\frac{ {\\theta_{i+1}^{t+1} - \\theta_{i }^{t+1}} } {z^c_{i+1} - z^c_{i }}\\right) - g_{a,i-\\frac{1}{2}}\\left(\\frac{ {\\theta_{i }^{t+1} - \\theta_{i-1}^{t+1}}}{ z^c_{i } - z^c_{i-1}} \\right) \\nonumber \\\\ & & + 2 \\left(T_{\\ell sun,i}^{t+1} - \\theta_i^{t+1}\\right) \\left( \\frac{g_{bh,i}\\Delta L_{sun,i}}{\\Delta z_i} \\right) \\nonumber \\\\ & & + 2 \\left(T_{\\ell shd,i}^{t+1} - \\theta_i^{t+1}\\right) \\left( \\frac{g_{bh,i}\\Delta L_{shd,i}}{\\Delta z_i} \\right) \\end{eqnarray}\\] The non-zero coefficients \\(\\alpha_{i=1,*}\\) of equation \\eqref{eqn_mlc_matrix} for \\(0<i<N\\) are thus given as \\[\\begin{eqnarray} \\label{eqn_atemp_terms} \\alpha_{1,1} &=& -\\left(\\dfrac{g_{a,i-\\frac{1}{2}}^{t+1}}{\\Delta z^c_{i,i-1}} \\right) \\\\ \\alpha_{1,2} &=& \\left(\\dfrac{\\rho_m}{\\Delta t}\\right) + \\left(\\dfrac{g_{a,i+\\frac{1}{2}}^{t+1} }{\\Delta z^c_{i+1,i}} \\right) + \\left(\\dfrac{g_{a,i+\\frac{1}{2}}^{t+1} }{\\Delta z^c_{i+1,i}} \\right) \\nonumber \\\\ & & + \\frac{2 g_{bh,i}^{t+1} \\left(\\Delta L_{sun,i} + \\Delta L_{shd,i}\\right)}{\\Delta z_i} \\\\ \\alpha_{1,3} &=& -\\left(\\dfrac{g_{a,i+\\frac{1}{2}}^{t+1}}{\\Delta z^c_{i+1,i}} \\right)\\\\ \\alpha_{1,7} &=& - \\frac{2 g_{bh,i}^{t+1} \\Delta L_{sun,i}}{\\Delta z_i}\\\\ \\alpha_{1,8} &=& - \\frac{2 g_{bh,i}^{t+1} \\Delta L_{shd,i}}{\\Delta z_i} \\\\ \\beta_{1} &=& \\left(\\dfrac{\\rho_m}{\\Delta t}\\right) \\theta_i^{t+1} \\end{eqnarray}\\] For the top vertical layer \\(i = N\\) , the coefficients \\(\\alpha_{i=1,*}\\) remain same as terms in equation \\eqref{eqn_atemp_terms} same except \\[\\begin{eqnarray} \\label{eqn_atemp_terms_top} \\beta_{1} &=& \\left(\\dfrac{\\rho_m}{\\Delta t}\\right) \\theta_i^{t+1} + \\left(\\dfrac{g_{a,i+\\frac{1}{2}}^{t+1}}{\\Delta z^c_{i+1,i}} \\right) \\theta_{ref}^{t+1} \\end{eqnarray}\\] where \\(\\theta_{ref}^{n+1}\\) is prescribed atmospheric temperature. For \\(i = 0\\) , the energy balance for the soil surface, \\(\\text{Rn}_0\\) , is given by \\[\\begin{eqnarray} \\label{eqn_soil_bc_air_heat} \\text{Rn}_0 &=& c_p(T_0^{n+1} - \\theta_1^{n+1})g_{a,0} \\nonumber \\\\ & & + \\lambda \\left\\{ h_{s0} q_{sat}(T_0^{n+1}) - q_1^{n+1} \\right\\}g_{s0} \\nonumber \\\\ & & + \\frac{\\kappa_{1}}{\\Delta z_{1/2}} \\left( T_0^{n+1} - T_{-1}^n\\right) \\nonumber \\\\ &=& c_p(T_0^{n+1} - \\theta_{1}^{n+1})g_{a,0} \\nonumber \\\\ & & + \\lambda \\left\\{ h_{s0} \\left[ q_{sat}(T_0^{n}) + s_0\\left( T_0^{n+1} - T_0^n\\right)\\right] - q_1^{n+1} \\right\\}g_{s0}\\nonumber \\\\ & & + \\frac{\\kappa_{1}}{\\Delta z_{1/2}} \\left( T_0^{n+1} - T_{-1}^n\\right) \\end{eqnarray}\\] where \\(\\theta_0^{n+1} = T_0^{n+1}\\) is the soil surface temperature, \\(T_{-1}^{n}\\) is the soil temperature of the first soil layer, and \\(z_{1/2}\\) is the distance between the soil surface and centroid of first soil layer. The non-zero coefficients \\(\\alpha_{1,*}\\) for \\(i = 0\\) are thus given as \\[\\begin{eqnarray} \\label{eqn_atemp_terms_soil} \\alpha_{1,2} &=& \\left( c_p g_{a,0} + \\lambda h_{s0} g_{s0} s_{0} + \\frac{\\kappa_{1}}{\\Delta z_{1/2}} \\right) \\\\ \\alpha_{1,3} &=& - c_p g_{a,0} \\\\ \\alpha_{1,6} &=& - \\lambda g_{s,0} \\\\ \\beta_{1} &=& \\text{Rn}_0 - \\lambda h_{s0} \\left[ q_{sat}(T_0^{n}) - s_0T_0^n\\right] g_{s0} + \\frac{\\kappa_{1}}{\\Delta z_{1/2}} T_{-1}^n \\end{eqnarray}\\] Air vapor pressure equation The discretized equation \\ref{eqn_mlc_qair} at an internal vertical layer (i.e. \\(0<i<N\\) ) \\[\\begin{eqnarray} \\frac{\\rho_m}{\\Delta t} \\left(q_i^{t+1} - q_i^t \\right) &=& + g_{a,i+\\frac{1}{2}} \\left(\\frac{ {q_{i+1}^{t+1} - q_{i }^{t+1}} } {z^c_{i+1} - z^c_{i }}\\right) - g_{a,i-\\frac{1}{2}}\\left(\\frac{ {q_{i }^{t+1} - q_{i-1}^{t+1}}}{ z^c_{i } - z^c_{i+1}} \\right) \\nonumber \\\\ & & + \\left[q_{sat, \\ell sun,i}^{t+1} - q_i^{t+1}\\right] \\left( \\frac{ g_{\\ell sun,i}\\Delta L_{sun,i}} {\\Delta z_i} \\right)\\nonumber \\\\ & & + \\left[q_{sat, \\ell sha,i}^{t+1} - q_i^{t+1}\\right] \\left( \\frac{ g_{\\ell sun,i}\\Delta L_{sun,i}} {\\Delta z_i} \\right) \\nonumber \\\\ &=& + g_{a,i+\\frac{1}{2}} \\left(\\frac{ {q_{i+1}^{t+1} - q_{i }^{t+1}} } {z^c_{i+1} - z^c_{i }}\\right) - g_{a,i-\\frac{1}{2}}\\left(\\frac{ {q_{i }^{t+1} - q_{i-1}^{t+1}}}{ z^c_{i } - z^c_{i+1}} \\right) \\nonumber \\\\ & & + \\left[ q_{sat, \\ell sun,i}^{t} + s_{sun,i} \\left( T_{\\ell,sun}^{n+1} - T_{\\ell, sun}^n \\right) - q_i^{t+1}\\right] \\left( \\frac{ g_{\\ell sun,i}\\Delta L_{sun,i}} {\\Delta z_i} \\right)\\nonumber \\\\ & & + \\left[ q_{sat, \\ell sha,i}^{t} + s_{sha,i} \\left( T_{\\ell,sha}^{n+1} - T_{\\ell, sha}^n \\right) - q_i^{t+1}\\right] \\left( \\frac{ g_{\\ell sun,i}\\Delta L_{sun,i}} {\\Delta z_i} \\right) \\end{eqnarray}\\] The non-zero coefficients \\(\\alpha_{i=2,*}\\) of equation \\eqref{eqn_mlc_matrix} for \\(0<i<N\\) are thus given as \\[\\begin{eqnarray} \\label{eqn_avapor_terms} \\alpha_{2,4} &=& -\\left(\\dfrac{g_{a,i-\\frac{1}{2}}^{t+1}}{\\Delta z^c_{i,i-1}} \\right) \\\\ \\alpha_{2,5} &=& \\left(\\dfrac{\\rho_m}{\\Delta t}\\right) + \\left(\\dfrac{g_{a,i-\\frac{1}{2}}^{t+1} }{\\Delta z^c_{i,i-1}} \\right) + \\left(\\dfrac{g_{a,i+\\frac{1}{2}}^{t+1} }{\\Delta z^c_{i+1,i}} \\right) \\nonumber \\\\ & & + \\frac{g_{lsun,i}^{t+1} \\Delta L_{sun,i} + g_{lshd,i}^{t+1} \\Delta L_{shd,i}}{\\Delta z_i} \\\\ \\alpha_{2,6} &=& -\\left(\\dfrac{g_{a,i+\\frac{1}{2}}^{t+1}}{\\Delta z^c_{i+1,i}} \\right) \\\\ \\alpha_{2,7} &=& - \\frac{s_{sun,i} g_{lsun,i}^{t+1} \\Delta L_{sun,i}}{\\Delta z_i} \\\\ \\alpha_{2,8} &=& - \\frac{s_{shd,i} g_{lshd,i}^{t+1} \\Delta L_{shd,i}}{\\Delta z_i} \\\\ \\beta_{2} &=& \\left(\\dfrac{\\rho_m}{\\Delta t}\\right) q_i^{t+1} \\nonumber \\\\ & & + \\frac{\\left(q_{sat}(T_{lsun,i}^{t+1}) - s_{sun,i} T_{lsun}^{t+1} \\right) g_{lsun,i}^{t+1}\\Delta L_{sun,i}}{\\Delta z_i} \\nonumber \\\\ & & + \\frac{\\left(q_{sat}(T_{lshd,i}^{t+1}) - s_{shd,i} T_{lshd}^{t+1} \\right) g_{lshd,i}^{t+1} \\Delta L_{shd,i}}{\\Delta z_i} \\end{eqnarray}\\] For the top vertical layer \\(i = N\\) , the coefficients \\(\\alpha_{i=2,*}\\) remain same as terms in equation \\eqref{eqn_avapor_terms} same except \\[\\begin{eqnarray} \\alpha_{2,6} &=& 0\\\\ \\beta_{2} &=& \\left(\\dfrac{\\rho_m}{\\Delta t}\\right) q_i^{t+1} \\nonumber \\\\ & & + \\frac{\\left(q_{sat}(T_{lsun,i}^{t+1}) - s_i T_{lsun}^{t+1} \\right) g_{lsun,i}^{t+1}\\Delta L_{sun,i}}{\\Delta z_i} \\nonumber \\\\ & & + \\frac{\\left(q_{sat}(T_{lshd,i}^{t+1}) - s_i T_{lshd}^{t+1} \\right) g_{lshd,i}^{t+1} \\Delta L_{shd,i}}{\\Delta z_i} \\nonumber \\\\ & & + \\left(\\dfrac{g_{a,i+\\frac{1}{2}}^{t+1}}{\\Delta z_{i+1,i}} \\right) q_{ref}^{n+1} \\end{eqnarray}\\] where \\(q_{ref}^{n+1}\\) is prescribed atmospheric water vapor pressure. For soil surface layer \\(i=0\\) , the water vapor balance is given by \\[\\begin{eqnarray} q_0^{n+1} &=& h_{s0} \\left[ q_{sat}(T_0^{n}) + s_0\\left( T_0^{n+1} - T_0^n\\right)\\right] \\nonumber \\\\ -h_{s0} s_0 T_0^{n+1} + q_0^{n+1} &=& h_{s0} \\left[ q_{sat}(T_0^{n}) - s_0T_0^n\\right] \\end{eqnarray}\\] The non-zero coefficients \\(\\alpha_{1,*}\\) for \\(i = 0\\) are thus given as \\[\\begin{eqnarray} \\alpha_{2,2} &=& -h_{s0} s_0 \\\\ \\alpha_{2,5} &=& 1\\\\ \\beta_{2} &=& h_{s0} \\left[ q_{sat}(T_0^{n}) - s_0T_0^n\\right] \\end{eqnarray}\\] Sunlit leave temperature The discretized equation \\ref{eqn_mlc_tsun} at an internal vertical layer (i.e. \\(0<i<N\\) ) is given by \\[\\begin{eqnarray} \\frac{c_{\\ell,i}}{\\Delta t} \\left( T_{\\ell sun,i}^{t+1} - T_{\\ell sun,i}^{t} \\right)&=& \\text{Rn}_{sun} - 2 \\left(T_{\\ell sun,i}^{t+1} - \\theta_i^{t+1}\\right) g_{bh,i} \\nonumber \\\\ & & - \\lambda \\left[ q_{sat, \\ell sun,i}^{t+1} - q_i^{t+1}\\right] g_{\\ell sun,i} \\nonumber \\\\ &=& \\text{Rn}_{sun} - 2 \\left(T_{\\ell sun,i}^{t+1} - \\theta_i^{t+1}\\right) g_{bh,i} \\nonumber \\\\ & &- \\lambda \\left[ q_{sat, \\ell sun,i}^{t} + s_{sun,i} \\left( T_{\\ell,sun}^{n+1} - T_{\\ell, sun}^n \\right) - q_i^{t+1}\\right] g_{\\ell sun,i} \\end{eqnarray}\\] The non-zero coefficients \\(\\alpha_{i=3,*}\\) of equation \\eqref{eqn_mlc_matrix} for \\(0<i<N\\) are thus given as \\[\\begin{eqnarray} \\alpha_{3,2} &=& -2 c_p g_{bh,i}^{t+1} \\\\ \\alpha_{3,5} &=& - \\lambda g_{lsun,i}^{t+1} \\\\ \\alpha_{3,7} &=& \\left( \\frac{c_{L,i}}{\\Delta t} \\right) + 2 c_p g_{bh,i}^{t+1} + \\lambda s_i g_{lsun,i}^{t+1} \\\\ \\beta_{3} &=& \\text{Rn}_{sun}^{t+1,0} + \\left(\\dfrac{c_{L,i}}{\\Delta t}\\right) T_{lsun,i}^{t+1} - \\lambda \\left(q_{sat}(T_{lsun,i}^{t+1}) - s_i T_{lsun}^{t+1} \\right) g_{lsun,i}^{t+1} \\end{eqnarray}\\] Shaded leave temperature The discretized equation \\ref{eqn_mlc_tshd} at an internal vertical layer (i.e. \\(0<i<N\\) ) is given by \\[\\begin{eqnarray} \\frac{c_{\\ell,i}}{\\Delta t} \\left( T_{\\ell shd,i}^{t+1} - T_{\\ell shd,i}^{t} \\right)&=& \\text{Rn}_{shd} - 2 \\left(T_{\\ell shd,i}^{t+1} - \\theta_i^{t+1}\\right) g_{bh,i} \\nonumber \\\\ & & - \\lambda \\left[ q_{sat, \\ell shd,i}^{t+1} - q_i^{t+1}\\right] g_{\\ell shd,i} \\nonumber \\\\ &=& \\text{Rn}_{shd} - 2 \\left(T_{\\ell shd,i}^{t+1} - \\theta_i^{t+1}\\right) g_{bh,i} \\nonumber \\\\ & & - \\lambda \\left[ q_{sat, \\ell shd,i}^{t} + s_{shd,i} \\left( T_{\\ell,shd}^{n+1} - T_{\\ell, shd}^n \\right) - q_i^{t+1}\\right] g_{\\ell shd,i} \\end{eqnarray}\\] The non-zero coefficients \\(\\alpha_{i=4,*}\\) of equation \\eqref{eqn_mlc_matrix} for \\(0<i<N\\) are thus given as \\[\\begin{eqnarray} \\alpha_{4,2} &=& -2 c_p g_{bh,i}^{t+1} \\\\ \\alpha_{4,5} &=& - \\lambda g_{lshd,i}^{t+1} \\\\ \\alpha_{4,8} &=& \\left( \\frac{c_{L,i}}{\\Delta t} \\right) + 2 c_p g_{bh,i}^{t+1} + \\lambda s_i g_{lshd,i}^{t+1} \\\\ \\beta_{4} &=& \\text{Rn}_{shd}^{t+1,0} + \\left(\\dfrac{c_{L,i}}{\\Delta t}\\right) T_{lshd,i}^{t+1} - \\lambda \\left(q_{sat}(T_{lshd,i}^{t+1}) - s_i T_{lshd}^{t+1} \\right) g_{lshd,i}^{t+1} \\end{eqnarray}\\]","title":"Multi layer canopy"},{"location":"tech_guide/mlc/multi_layer_canopy/#governing-equations","text":"The equations for the time evolution of air temperature, \\(\\theta\\) , and water vapor, \\(q\\) , sunlit leaf temperature, \\(T_{\\ell sun}\\) , and shaded leaf temperature, \\(T_{\\ell shd}\\) , in a MLCM is given by \\[\\begin{eqnarray} \\rho_mc_p \\left(\\frac{\\partial\\theta}{\\partial t}\\right) &=& c_p \\nabla \\cdot \\left( g_{a} \\nabla \\theta \\right) + \\frac{Q_{\\theta sun,i} \\Delta L_{sun,i}}{\\Delta z_i} + \\frac{Q_{\\theta shd,i} \\Delta L_{shd,i}}{\\Delta z_i} \\label{eqn_mlc_tair} + S_\\theta \\\\ \\rho_m \\left( \\frac{\\partial q}{\\partial t} \\right) &=& \\nabla \\cdot \\left( g_{a} \\nabla q \\right) + \\frac{Q_{qsun,i} \\Delta L_{sun,i}}{\\Delta z_i} + \\frac{Q_{qshd,i} \\Delta L_{shd,i}}{\\Delta z_i} \\label{eqn_mlc_qair} + S_q \\\\ c_{\\ell} \\left( \\frac{\\partial T_{\\ell sun}}{\\partial t} \\right) &=& \\text{R}_{n,sun} - Q_{\\theta sun} - \\lambda Q_{qsun} + S_{\\ell sun} \\label{eqn_mlc_tsun} \\\\ c_{\\ell} \\left( \\frac{\\partial T_{\\ell shd}}{\\partial t} \\right) &=& \\text{R}_{n,shd} - Q_{\\theta shd} - \\lambda Q_{qshd} + S_{\\ell shd} \\label{eqn_mlc_tshd} \\end{eqnarray}\\] where \\(\\rho_m\\) is density of air, \\(\\lambda\\) is latent heat of vaporization for water, \\(c_p\\) is specific heat capacity of air, \\(c_{\\ell}\\) is specific heat capacity of leaf, \\(g_{a}\\) is atmospheric conductance, \\(\\Delta L_{sun}\\) is the leaf area index of the sunlit leaf, \\(\\Delta L_{shd}\\) is the leaf area index of the shaded leaf, \\(Q_{\\theta sun}\\) is the heat source from the sunlit leaf to the canopy air, \\(Q_{\\theta shd}\\) is the heat source from the shaded leaf to the canopy air, \\(Q_{qsun}\\) is the water vapor source from the sunlit leaf the canopy air, \\(Q_{qsun}\\) is the water vapor source from the shaded leaf the canopy air, \\(\\text{Rn}_{sun}\\) is the net shortwave and longwave radiation absorbed by the sunlit leaf, and \\(\\text{Rn}_{shd}\\) is the net shortwave and longwave radiation absorbed by the shaded leaf. The source of heat and water vapor for sunlit and shaded leaves at the \\(i\\) -th layer are given by \\[\\begin{eqnarray} Q_{\\theta sun} &=& 2c_p(T_{\\ell sun} - \\theta_i)g_{bh} \\\\ Q_{\\theta shd} &=& 2c_p(T_{\\ell shd} - \\theta_i)g_{bh}\\\\ Q_{qsun} &=& (q_{sat}(T_{\\ell sun}) - q_i) g_{\\ell sun} \\\\ Q_{qshd} &=& (q_{sat}(T_{\\ell shd}) - q_i) g_{\\ell shd} \\end{eqnarray}\\] where \\(g_{bh,i}\\) is the boundary layer conductance for heat, \\(g_{bw,i}\\) is the boundary layer conductance for water vapor, \\(g_{\\ell sun,i}\\) is the total leaf conductance for the sunlit leaf, and \\(g_{\\ell shd,i}\\) is the total leaf conductance for the shaded leaf. The leaf conductances are given as \\[\\begin{eqnarray} g_{\\ell sun} &=& \\left(\\frac{1}{g_{bw}^{-1} + g_{sw,sun}^{-1}}\\right) f_{dry} + g_{bw} f_{wet}\\\\ g_{\\ell shd} &=& \\left(\\frac{1}{g_{bw}^{-1} + g_{sw,shd}^{-1}}\\right) f_{dry} + g_{bw} f_{wet} \\end{eqnarray}\\] where \\(g_{sw,sun}\\) is the stomatal conductance for the sunlit leaf, and \\(g_{sw,shd}\\) is the stomatal conductance for the shaded leaf. The net radiation absorbed by sunlit and shaded leaf are given by \\[\\begin{eqnarray} \\label{eqn_rn} \\text{Rn}_{sun} &=& \\vec{I}^{d}_{sun} + \\vec{I}^{b}_{sun} + \\vec{L}_{sun}\\\\ \\text{Rn}_{shd} &=& \\vec{I}^{d}_{shd} + \\vec{L}_{shd} \\label{eqn:net_} \\end{eqnarray}\\] where \\(\\vec{I}^{d}\\) is absorbed diffuse radiation, \\(\\vec{I}^{b}\\) is absorbed beam radiation, and \\(\\vec{L}\\) is absorbed longwave radiation. The finite volume and implicit time discretization of equation \\eqref{eqn_mlc_tair}-\\eqref{eqn_mlc_tshd} leads to the following equations for the \\(i\\) -th layer can be written as \\[\\begin{eqnarray} \\begin{bmatrix} \\alpha_{1,1} & {\\alpha_{1,2}} & {\\alpha_{1,3}} & \\alpha_{1,4} & \\alpha_{1,5} & \\alpha_{0,6} & {\\alpha_{1,7}} & {\\alpha_{1,8}}\\\\ 0 & 0 & 0 & {\\alpha_{2,4}} & {\\alpha_{2,5}} & {\\alpha_{2,6}} & {\\alpha_{2,7}} & {\\alpha_{2,8}}\\\\ 0 & {\\alpha_{3,2}} & 0 & 0 & {\\alpha_{3,5}} & 0 & {\\alpha_{3,7}} & 0 \\\\ 0 & {\\alpha_{4,2}} & 0 & 0 & {\\alpha_{4,5}} & 0 & 0 & {\\alpha_{4,8}}\\\\ \\end{bmatrix} \\begin{bmatrix} \\theta_{i-1}^{t+1} \\\\ \\theta_{i }^{t+1} \\\\ \\theta_{i+1}^{t+1} \\\\ q_{i-1}^{t+1} \\\\ q_{i }^{t+1} \\\\ q_{i+1}^{t+1} \\\\ T_{lsun,i}^{t+1} \\\\ T_{lshd,i}^{t+1} \\end{bmatrix} = \\begin{bmatrix} \\beta_{1} \\\\ \\beta_{2} \\\\ \\beta_{3} \\\\ \\beta_{4} \\end{bmatrix} \\label{eqn_mlc_matrix} \\end{eqnarray}\\]","title":"Governing equations"},{"location":"tech_guide/mlc/multi_layer_canopy/#air-temperature-equation","text":"The discretized equation \\ref{eqn_mlc_tair} at an internal vertical layer (i.e. \\(0<i<N\\) ) \\[\\begin{eqnarray} \\frac{\\rho_m }{\\Delta t} \\left(\\theta_i^{t+1} - \\theta_i^{t}\\right) &=& + g_{a,i+\\frac{1}{2}} \\left(\\frac{ {\\theta_{i+1}^{t+1} - \\theta_{i }^{t+1}} } {z^c_{i+1} - z^c_{i }}\\right) - g_{a,i-\\frac{1}{2}}\\left(\\frac{ {\\theta_{i }^{t+1} - \\theta_{i-1}^{t+1}}}{ z^c_{i } - z^c_{i-1}} \\right) \\nonumber \\\\ & & + 2 \\left(T_{\\ell sun,i}^{t+1} - \\theta_i^{t+1}\\right) \\left( \\frac{g_{bh,i}\\Delta L_{sun,i}}{\\Delta z_i} \\right) \\nonumber \\\\ & & + 2 \\left(T_{\\ell shd,i}^{t+1} - \\theta_i^{t+1}\\right) \\left( \\frac{g_{bh,i}\\Delta L_{shd,i}}{\\Delta z_i} \\right) \\end{eqnarray}\\] The non-zero coefficients \\(\\alpha_{i=1,*}\\) of equation \\eqref{eqn_mlc_matrix} for \\(0<i<N\\) are thus given as \\[\\begin{eqnarray} \\label{eqn_atemp_terms} \\alpha_{1,1} &=& -\\left(\\dfrac{g_{a,i-\\frac{1}{2}}^{t+1}}{\\Delta z^c_{i,i-1}} \\right) \\\\ \\alpha_{1,2} &=& \\left(\\dfrac{\\rho_m}{\\Delta t}\\right) + \\left(\\dfrac{g_{a,i+\\frac{1}{2}}^{t+1} }{\\Delta z^c_{i+1,i}} \\right) + \\left(\\dfrac{g_{a,i+\\frac{1}{2}}^{t+1} }{\\Delta z^c_{i+1,i}} \\right) \\nonumber \\\\ & & + \\frac{2 g_{bh,i}^{t+1} \\left(\\Delta L_{sun,i} + \\Delta L_{shd,i}\\right)}{\\Delta z_i} \\\\ \\alpha_{1,3} &=& -\\left(\\dfrac{g_{a,i+\\frac{1}{2}}^{t+1}}{\\Delta z^c_{i+1,i}} \\right)\\\\ \\alpha_{1,7} &=& - \\frac{2 g_{bh,i}^{t+1} \\Delta L_{sun,i}}{\\Delta z_i}\\\\ \\alpha_{1,8} &=& - \\frac{2 g_{bh,i}^{t+1} \\Delta L_{shd,i}}{\\Delta z_i} \\\\ \\beta_{1} &=& \\left(\\dfrac{\\rho_m}{\\Delta t}\\right) \\theta_i^{t+1} \\end{eqnarray}\\] For the top vertical layer \\(i = N\\) , the coefficients \\(\\alpha_{i=1,*}\\) remain same as terms in equation \\eqref{eqn_atemp_terms} same except \\[\\begin{eqnarray} \\label{eqn_atemp_terms_top} \\beta_{1} &=& \\left(\\dfrac{\\rho_m}{\\Delta t}\\right) \\theta_i^{t+1} + \\left(\\dfrac{g_{a,i+\\frac{1}{2}}^{t+1}}{\\Delta z^c_{i+1,i}} \\right) \\theta_{ref}^{t+1} \\end{eqnarray}\\] where \\(\\theta_{ref}^{n+1}\\) is prescribed atmospheric temperature. For \\(i = 0\\) , the energy balance for the soil surface, \\(\\text{Rn}_0\\) , is given by \\[\\begin{eqnarray} \\label{eqn_soil_bc_air_heat} \\text{Rn}_0 &=& c_p(T_0^{n+1} - \\theta_1^{n+1})g_{a,0} \\nonumber \\\\ & & + \\lambda \\left\\{ h_{s0} q_{sat}(T_0^{n+1}) - q_1^{n+1} \\right\\}g_{s0} \\nonumber \\\\ & & + \\frac{\\kappa_{1}}{\\Delta z_{1/2}} \\left( T_0^{n+1} - T_{-1}^n\\right) \\nonumber \\\\ &=& c_p(T_0^{n+1} - \\theta_{1}^{n+1})g_{a,0} \\nonumber \\\\ & & + \\lambda \\left\\{ h_{s0} \\left[ q_{sat}(T_0^{n}) + s_0\\left( T_0^{n+1} - T_0^n\\right)\\right] - q_1^{n+1} \\right\\}g_{s0}\\nonumber \\\\ & & + \\frac{\\kappa_{1}}{\\Delta z_{1/2}} \\left( T_0^{n+1} - T_{-1}^n\\right) \\end{eqnarray}\\] where \\(\\theta_0^{n+1} = T_0^{n+1}\\) is the soil surface temperature, \\(T_{-1}^{n}\\) is the soil temperature of the first soil layer, and \\(z_{1/2}\\) is the distance between the soil surface and centroid of first soil layer. The non-zero coefficients \\(\\alpha_{1,*}\\) for \\(i = 0\\) are thus given as \\[\\begin{eqnarray} \\label{eqn_atemp_terms_soil} \\alpha_{1,2} &=& \\left( c_p g_{a,0} + \\lambda h_{s0} g_{s0} s_{0} + \\frac{\\kappa_{1}}{\\Delta z_{1/2}} \\right) \\\\ \\alpha_{1,3} &=& - c_p g_{a,0} \\\\ \\alpha_{1,6} &=& - \\lambda g_{s,0} \\\\ \\beta_{1} &=& \\text{Rn}_0 - \\lambda h_{s0} \\left[ q_{sat}(T_0^{n}) - s_0T_0^n\\right] g_{s0} + \\frac{\\kappa_{1}}{\\Delta z_{1/2}} T_{-1}^n \\end{eqnarray}\\]","title":"Air temperature equation"},{"location":"tech_guide/mlc/multi_layer_canopy/#air-vapor-pressure-equation","text":"The discretized equation \\ref{eqn_mlc_qair} at an internal vertical layer (i.e. \\(0<i<N\\) ) \\[\\begin{eqnarray} \\frac{\\rho_m}{\\Delta t} \\left(q_i^{t+1} - q_i^t \\right) &=& + g_{a,i+\\frac{1}{2}} \\left(\\frac{ {q_{i+1}^{t+1} - q_{i }^{t+1}} } {z^c_{i+1} - z^c_{i }}\\right) - g_{a,i-\\frac{1}{2}}\\left(\\frac{ {q_{i }^{t+1} - q_{i-1}^{t+1}}}{ z^c_{i } - z^c_{i+1}} \\right) \\nonumber \\\\ & & + \\left[q_{sat, \\ell sun,i}^{t+1} - q_i^{t+1}\\right] \\left( \\frac{ g_{\\ell sun,i}\\Delta L_{sun,i}} {\\Delta z_i} \\right)\\nonumber \\\\ & & + \\left[q_{sat, \\ell sha,i}^{t+1} - q_i^{t+1}\\right] \\left( \\frac{ g_{\\ell sun,i}\\Delta L_{sun,i}} {\\Delta z_i} \\right) \\nonumber \\\\ &=& + g_{a,i+\\frac{1}{2}} \\left(\\frac{ {q_{i+1}^{t+1} - q_{i }^{t+1}} } {z^c_{i+1} - z^c_{i }}\\right) - g_{a,i-\\frac{1}{2}}\\left(\\frac{ {q_{i }^{t+1} - q_{i-1}^{t+1}}}{ z^c_{i } - z^c_{i+1}} \\right) \\nonumber \\\\ & & + \\left[ q_{sat, \\ell sun,i}^{t} + s_{sun,i} \\left( T_{\\ell,sun}^{n+1} - T_{\\ell, sun}^n \\right) - q_i^{t+1}\\right] \\left( \\frac{ g_{\\ell sun,i}\\Delta L_{sun,i}} {\\Delta z_i} \\right)\\nonumber \\\\ & & + \\left[ q_{sat, \\ell sha,i}^{t} + s_{sha,i} \\left( T_{\\ell,sha}^{n+1} - T_{\\ell, sha}^n \\right) - q_i^{t+1}\\right] \\left( \\frac{ g_{\\ell sun,i}\\Delta L_{sun,i}} {\\Delta z_i} \\right) \\end{eqnarray}\\] The non-zero coefficients \\(\\alpha_{i=2,*}\\) of equation \\eqref{eqn_mlc_matrix} for \\(0<i<N\\) are thus given as \\[\\begin{eqnarray} \\label{eqn_avapor_terms} \\alpha_{2,4} &=& -\\left(\\dfrac{g_{a,i-\\frac{1}{2}}^{t+1}}{\\Delta z^c_{i,i-1}} \\right) \\\\ \\alpha_{2,5} &=& \\left(\\dfrac{\\rho_m}{\\Delta t}\\right) + \\left(\\dfrac{g_{a,i-\\frac{1}{2}}^{t+1} }{\\Delta z^c_{i,i-1}} \\right) + \\left(\\dfrac{g_{a,i+\\frac{1}{2}}^{t+1} }{\\Delta z^c_{i+1,i}} \\right) \\nonumber \\\\ & & + \\frac{g_{lsun,i}^{t+1} \\Delta L_{sun,i} + g_{lshd,i}^{t+1} \\Delta L_{shd,i}}{\\Delta z_i} \\\\ \\alpha_{2,6} &=& -\\left(\\dfrac{g_{a,i+\\frac{1}{2}}^{t+1}}{\\Delta z^c_{i+1,i}} \\right) \\\\ \\alpha_{2,7} &=& - \\frac{s_{sun,i} g_{lsun,i}^{t+1} \\Delta L_{sun,i}}{\\Delta z_i} \\\\ \\alpha_{2,8} &=& - \\frac{s_{shd,i} g_{lshd,i}^{t+1} \\Delta L_{shd,i}}{\\Delta z_i} \\\\ \\beta_{2} &=& \\left(\\dfrac{\\rho_m}{\\Delta t}\\right) q_i^{t+1} \\nonumber \\\\ & & + \\frac{\\left(q_{sat}(T_{lsun,i}^{t+1}) - s_{sun,i} T_{lsun}^{t+1} \\right) g_{lsun,i}^{t+1}\\Delta L_{sun,i}}{\\Delta z_i} \\nonumber \\\\ & & + \\frac{\\left(q_{sat}(T_{lshd,i}^{t+1}) - s_{shd,i} T_{lshd}^{t+1} \\right) g_{lshd,i}^{t+1} \\Delta L_{shd,i}}{\\Delta z_i} \\end{eqnarray}\\] For the top vertical layer \\(i = N\\) , the coefficients \\(\\alpha_{i=2,*}\\) remain same as terms in equation \\eqref{eqn_avapor_terms} same except \\[\\begin{eqnarray} \\alpha_{2,6} &=& 0\\\\ \\beta_{2} &=& \\left(\\dfrac{\\rho_m}{\\Delta t}\\right) q_i^{t+1} \\nonumber \\\\ & & + \\frac{\\left(q_{sat}(T_{lsun,i}^{t+1}) - s_i T_{lsun}^{t+1} \\right) g_{lsun,i}^{t+1}\\Delta L_{sun,i}}{\\Delta z_i} \\nonumber \\\\ & & + \\frac{\\left(q_{sat}(T_{lshd,i}^{t+1}) - s_i T_{lshd}^{t+1} \\right) g_{lshd,i}^{t+1} \\Delta L_{shd,i}}{\\Delta z_i} \\nonumber \\\\ & & + \\left(\\dfrac{g_{a,i+\\frac{1}{2}}^{t+1}}{\\Delta z_{i+1,i}} \\right) q_{ref}^{n+1} \\end{eqnarray}\\] where \\(q_{ref}^{n+1}\\) is prescribed atmospheric water vapor pressure. For soil surface layer \\(i=0\\) , the water vapor balance is given by \\[\\begin{eqnarray} q_0^{n+1} &=& h_{s0} \\left[ q_{sat}(T_0^{n}) + s_0\\left( T_0^{n+1} - T_0^n\\right)\\right] \\nonumber \\\\ -h_{s0} s_0 T_0^{n+1} + q_0^{n+1} &=& h_{s0} \\left[ q_{sat}(T_0^{n}) - s_0T_0^n\\right] \\end{eqnarray}\\] The non-zero coefficients \\(\\alpha_{1,*}\\) for \\(i = 0\\) are thus given as \\[\\begin{eqnarray} \\alpha_{2,2} &=& -h_{s0} s_0 \\\\ \\alpha_{2,5} &=& 1\\\\ \\beta_{2} &=& h_{s0} \\left[ q_{sat}(T_0^{n}) - s_0T_0^n\\right] \\end{eqnarray}\\]","title":"Air vapor pressure equation"},{"location":"tech_guide/mlc/multi_layer_canopy/#sunlit-leave-temperature","text":"The discretized equation \\ref{eqn_mlc_tsun} at an internal vertical layer (i.e. \\(0<i<N\\) ) is given by \\[\\begin{eqnarray} \\frac{c_{\\ell,i}}{\\Delta t} \\left( T_{\\ell sun,i}^{t+1} - T_{\\ell sun,i}^{t} \\right)&=& \\text{Rn}_{sun} - 2 \\left(T_{\\ell sun,i}^{t+1} - \\theta_i^{t+1}\\right) g_{bh,i} \\nonumber \\\\ & & - \\lambda \\left[ q_{sat, \\ell sun,i}^{t+1} - q_i^{t+1}\\right] g_{\\ell sun,i} \\nonumber \\\\ &=& \\text{Rn}_{sun} - 2 \\left(T_{\\ell sun,i}^{t+1} - \\theta_i^{t+1}\\right) g_{bh,i} \\nonumber \\\\ & &- \\lambda \\left[ q_{sat, \\ell sun,i}^{t} + s_{sun,i} \\left( T_{\\ell,sun}^{n+1} - T_{\\ell, sun}^n \\right) - q_i^{t+1}\\right] g_{\\ell sun,i} \\end{eqnarray}\\] The non-zero coefficients \\(\\alpha_{i=3,*}\\) of equation \\eqref{eqn_mlc_matrix} for \\(0<i<N\\) are thus given as \\[\\begin{eqnarray} \\alpha_{3,2} &=& -2 c_p g_{bh,i}^{t+1} \\\\ \\alpha_{3,5} &=& - \\lambda g_{lsun,i}^{t+1} \\\\ \\alpha_{3,7} &=& \\left( \\frac{c_{L,i}}{\\Delta t} \\right) + 2 c_p g_{bh,i}^{t+1} + \\lambda s_i g_{lsun,i}^{t+1} \\\\ \\beta_{3} &=& \\text{Rn}_{sun}^{t+1,0} + \\left(\\dfrac{c_{L,i}}{\\Delta t}\\right) T_{lsun,i}^{t+1} - \\lambda \\left(q_{sat}(T_{lsun,i}^{t+1}) - s_i T_{lsun}^{t+1} \\right) g_{lsun,i}^{t+1} \\end{eqnarray}\\]","title":"Sunlit leave temperature"},{"location":"tech_guide/mlc/multi_layer_canopy/#shaded-leave-temperature","text":"The discretized equation \\ref{eqn_mlc_tshd} at an internal vertical layer (i.e. \\(0<i<N\\) ) is given by \\[\\begin{eqnarray} \\frac{c_{\\ell,i}}{\\Delta t} \\left( T_{\\ell shd,i}^{t+1} - T_{\\ell shd,i}^{t} \\right)&=& \\text{Rn}_{shd} - 2 \\left(T_{\\ell shd,i}^{t+1} - \\theta_i^{t+1}\\right) g_{bh,i} \\nonumber \\\\ & & - \\lambda \\left[ q_{sat, \\ell shd,i}^{t+1} - q_i^{t+1}\\right] g_{\\ell shd,i} \\nonumber \\\\ &=& \\text{Rn}_{shd} - 2 \\left(T_{\\ell shd,i}^{t+1} - \\theta_i^{t+1}\\right) g_{bh,i} \\nonumber \\\\ & & - \\lambda \\left[ q_{sat, \\ell shd,i}^{t} + s_{shd,i} \\left( T_{\\ell,shd}^{n+1} - T_{\\ell, shd}^n \\right) - q_i^{t+1}\\right] g_{\\ell shd,i} \\end{eqnarray}\\] The non-zero coefficients \\(\\alpha_{i=4,*}\\) of equation \\eqref{eqn_mlc_matrix} for \\(0<i<N\\) are thus given as \\[\\begin{eqnarray} \\alpha_{4,2} &=& -2 c_p g_{bh,i}^{t+1} \\\\ \\alpha_{4,5} &=& - \\lambda g_{lshd,i}^{t+1} \\\\ \\alpha_{4,8} &=& \\left( \\frac{c_{L,i}}{\\Delta t} \\right) + 2 c_p g_{bh,i}^{t+1} + \\lambda s_i g_{lshd,i}^{t+1} \\\\ \\beta_{4} &=& \\text{Rn}_{shd}^{t+1,0} + \\left(\\dfrac{c_{L,i}}{\\Delta t}\\right) T_{lshd,i}^{t+1} - \\lambda \\left(q_{sat}(T_{lshd,i}^{t+1}) - s_i T_{lshd}^{t+1} \\right) g_{lshd,i}^{t+1} \\end{eqnarray}\\]","title":"Shaded leave temperature"},{"location":"tech_guide/mlc/overview/","text":"Overview The Multi-Layer Canopy Model version 1 (MLCMv1) for the Energy Exascale Earth System Model (E3SM) Land Model (ELM), which is based on CLM-ml v1 1 , resolves the micro-climate created by the vegetation canopies. The MLCMv1 has been benchmarked against the CLM-ml v1 for the Ameriflux US-Unversity of Michigan Biological Station site. The MLCMv1 uses PETSc to provide support for heterogeneous computing architectures. The performance portability of the model has been studied on NVIDIA and AMD GPUs, and a speedup of 25-50 times has been shown on a GPU relative to a CPU. Gordon B Bonan, Edward G Patton, John J Finnigan, Dennis D Baldocchi, and Ian N Harman. Moving beyond the incorrect but useful paradigm: reevaluating big-leaf and multilayer plant canopies to model biosphere-atmosphere fluxes\u2013a review. Agricultural and Forest Meteorology , 306:108435, 2021. \u21a9","title":"Overview"},{"location":"tech_guide/mlc/overview/#overview","text":"The Multi-Layer Canopy Model version 1 (MLCMv1) for the Energy Exascale Earth System Model (E3SM) Land Model (ELM), which is based on CLM-ml v1 1 , resolves the micro-climate created by the vegetation canopies. The MLCMv1 has been benchmarked against the CLM-ml v1 for the Ameriflux US-Unversity of Michigan Biological Station site. The MLCMv1 uses PETSc to provide support for heterogeneous computing architectures. The performance portability of the model has been studied on NVIDIA and AMD GPUs, and a speedup of 25-50 times has been shown on a GPU relative to a CPU. Gordon B Bonan, Edward G Patton, John J Finnigan, Dennis D Baldocchi, and Ian N Harman. Moving beyond the incorrect but useful paradigm: reevaluating big-leaf and multilayer plant canopies to model biosphere-atmosphere fluxes\u2013a review. Agricultural and Forest Meteorology , 306:108435, 2021. \u21a9","title":"Overview"},{"location":"tech_guide/mlc/photosynthesis_biological_demand/","text":"Governing equations The net photosynthetic uptake of CO \\(_2\\) , \\(A_n\\) [ \\(\\mu\\) mol CO \\(_2\\) m \\(^{-2}\\) s \\(^{-1}\\) ], is given as \\[\\begin{eqnarray} \\label{eqn_an_bio_demand} A_n &=& \\min(A_c, A_j, A_p) - R_d \\nonumber \\\\ &=& A_g - R_d \\end{eqnarray}\\] where \\(A_c\\) [ \\(\\mu\\) mol CO \\(_2\\) m \\(^{-2}\\) s \\(^{-1}\\) ] is the Rubisco-limited CO \\(_2\\) assimilation, \\(A_j\\) [ \\(\\mu\\) mol CO \\(_2\\) m \\(^{-2}\\) s \\(^{-1}\\) ] is the light-limited CO \\(_2\\) assimilation, \\(A_p\\) [ \\(\\mu\\) mol CO \\(_2\\) m \\(^{-2}\\) s \\(^{-1}\\) ] is the PEP carboxylase-limited CO \\(_2\\) assimilation, \\(A_g\\) [ \\(\\mu\\) mol CO \\(_2\\) m \\(^{-2}\\) s \\(^{-1}\\) ] is the co-limited gross CO \\(_2\\) assimilation, and \\(R_d\\) [ \\(\\mu\\) mol CO \\(_2\\) m \\(^{-2}\\) s \\(^{-1}\\) ] is mitochondrial respiration. \\(A_g\\) is given as the smaller of two quadratic roots \\[\\begin{eqnarray} 0.98A^2_i - (A_c + A_j) + A_c A_j &=& 0 \\\\ 0.98A^2_g - (A_i + A_p) + A_i A_p &=& 0 \\end{eqnarray}\\] The assimilation fluxes ( \\(A_c\\) , \\(A_j\\) , and \\(A_p\\) ) for C3 and C4 photosynthesis pathway are described next. C3 Photosynthesis The CO \\(_2\\) assimilation fluxes for C3 photosynthesis are \\[\\begin{eqnarray} A_c &=& \\frac{V_{cmax} (c_i - \\Gamma^*)}{c_i + K_c(1 - o_i/K_o)}\\\\[0.4em] A_j &=& \\frac{J}{4}\\left( \\frac{c_i - \\Gamma^*}{c_i + 2 \\Gamma^*}\\right) \\\\[0.4em] A_p &=& 0 \\end{eqnarray}\\] where \\(V_{cmax}\\) [ \\(\\mu\\) mol CO \\(_2\\) m \\(^{-2}\\) s \\(^{-1}\\) ] maximum rate of carboxylation, \\(c_i\\) [ \\(\\mu\\) mol CO \\(_2\\) mol \\(^{-1}\\) ] is the intercellular CO \\(_2\\) , \\(o_i\\) [ \\(\\mu\\) mol O \\(_2\\) mol \\(^{-1}\\) ] is the intercellular O \\(_2\\) , \\(K_c\\) [ \\(\\mu\\) mol CO \\(_2\\) mol \\(^{-1}\\) ] is the Michaelist-Mention constant for CO \\(_2\\) , \\(K_o\\) [ \\(\\mu\\) mol O \\(_2\\) mol \\(^{-1}\\) ] is the Michaelist-Mention constant for O \\(_2\\) , \\(J\\) [ \\(\\mu\\) mol CO \\(_2\\) mol \\(^{-1}\\) ] is the electron transport rate, and \\(\\Gamma^*\\) [ \\(\\mu\\) mol CO \\(_2\\) mol \\(^{-1}\\) ] is the compensation point defined as the \\(c_i\\) at which no net CO \\(_2\\) update occurs. The rate of electron transport is related to photosynthetically active radiation and is given as the smaller root of the following quadratic equation. \\[\\begin{equation} \\Theta_j J^2 - (I_{PSII} + J_{max}) + I_{PSII} J_{max} = 0 \\end{equation}\\] where \\(I_{PSII}\\) [ \\(\\mu\\) mol CO \\(_2\\) mol \\(^{-1}\\) ] is the amount of light utilized in photosynthesis II, \\(J_{max}\\) [ \\(\\mu\\) mol CO \\(_2\\) mol \\(^{-1}\\) ] is the maximum transport rate, and \\(\\Theta_j = 0.9\\) is the curvature parameter. The amount of light utilized in photosynthesis II is \\[\\begin{equation} I_{PSII} = \\frac{\\Phi_{PSII}}{2} \\alpha_\\ell \\overrightarrow{I}_{PAR} \\end{equation}\\] where \\(\\Phi_{PSII} = 0.7\\) [mol mol \\(^{-1}\\) ] is the quantum yield of photosystem II, \\(\\alpha_\\ell = 1\\) is the leaf absorptance, \\(\\overrightarrow{I}_{PAR}\\) [ \\(\\mu\\) mol photon m \\(^{-2}\\) s \\(^{-1}\\) ] is the absorbed photosynthetically active radiation. The parameters \\(K_c\\) , \\(K_o\\) , \\(\\Gamma^*\\) , \\(V_{cmax}\\) , \\(J_{max}\\) , and \\(R_d\\) vary from their values at 25 \\(^0\\) C as function of leaf temperature, \\(T_\\ell\\) , that are given as \\[\\begin{eqnarray} K_{c} &=& K_{c25} f(T_\\ell) \\\\[0.4em] K_{o} &=& K_{o25} f(T_\\ell) \\\\[0.4em] \\Gamma^* &=& \\Gamma^* f(T_\\ell) \\\\[0.4em] V_{cmax} &=& V_{cmax25} f(T_\\ell) f_H(T_\\ell)\\\\[0.4em] J_{max} &=& J_{cmax25} f(T_\\ell) f_H(T_\\ell)\\\\[0.4em] R_{d} &=& R_{d25} f(T_\\ell) f_H(T_\\ell) \\end{eqnarray}\\] where \\[\\begin{eqnarray} f(T_\\ell) &=& \\exp \\left[ \\frac{\\Delta H_a}{298.15 \\mathcal{R}} \\left( 1 - \\frac{298.15}{T_\\ell} \\right) \\right] \\\\[0.4em] f_H(T_\\ell) &=& \\left[1 + \\exp \\left( \\frac{298.15\\Delta S - \\Delta H_d}{298.15\\mathcal{R}} \\right) \\right] \\left[1 + \\exp \\left( \\frac{\\Delta S T_\\ell - \\Delta H_d}{\\mathcal{R} T_\\ell} \\right)\\right]^{-1} \\end{eqnarray}\\] Lastly, the \\(J_{max}\\) and \\(R_{d}\\) at 25 \\(^0\\) C are given as \\[\\begin{eqnarray} J_{max25} &=& 1.67 V_{cmax25} \\\\ R_{d25} &=& 0.015 V_{cmax25} \\end{eqnarray}\\] C4 Photosynthesis The CO \\(_2\\) assimilation fluxes for C4 photosynthesis are \\[\\begin{eqnarray} A_c &=& V_{cmax} \\\\ A_j &=& \\alpha_\\ell \\overrightarrow{I}_{PAR} E\\\\ A_p &=& k_p c_i \\end{eqnarray}\\] where \\(E = 0.05\\) [mol mol \\(^{-2}\\) ] is the quantum yield and \\(k_p\\) [mol m \\(^{-2}\\) s \\(^{-1}\\) ] is the initial slope of the CO \\(_2\\) response curve. The temperature dependence of \\(V_{cmax}\\) , \\(R_d\\) , and \\(k_p\\) are given as \\[\\begin{eqnarray} V_{cmax} &=& V_{cmax25} Q_{10}^{(T_\\ell - 298.16)/10} \\left( 1 + \\exp[s_1(T_\\ell - s_2)] \\right)^{-1} \\left( 1 + \\exp[s_3(s_4 - T_\\ell)] \\right)^{-1} \\\\[0.4em] R_d &=& R_{d25} Q_{10}^{(T_\\ell - 298.16)/10} \\left( 1 + \\exp[s_5(s_6 - T_\\ell)] \\right)^{-1} \\\\[0.4em] k_p &=& k_{p25} Q_{10}^{(T_\\ell - 298.16)/10} \\end{eqnarray}\\] where \\(Q_{10} = 2\\) , \\(s_1 = 0.3\\) [K \\(^{-1}\\) ], \\(s_2 = 313.15\\) [K], \\(s_3 = 0.2\\) [K \\(^{-1}\\) ], \\(s_4 = 288.15\\) [K], \\(s_5 = 1.3\\) [K \\(^{-1}\\) ], and \\(s_6 = 328.15\\) [K]. The max \\(R_{d}\\) and \\(k_{p}\\) at 25 \\(^0\\) C are given as \\[\\begin{eqnarray} R_{d25} &=& 0.025 V_{cmax25} \\\\ k_{p25} &=& 0.02 V_{cmax25} \\end{eqnarray}\\]","title":"Photosynthesis biological demand"},{"location":"tech_guide/mlc/photosynthesis_biological_demand/#governing-equations","text":"The net photosynthetic uptake of CO \\(_2\\) , \\(A_n\\) [ \\(\\mu\\) mol CO \\(_2\\) m \\(^{-2}\\) s \\(^{-1}\\) ], is given as \\[\\begin{eqnarray} \\label{eqn_an_bio_demand} A_n &=& \\min(A_c, A_j, A_p) - R_d \\nonumber \\\\ &=& A_g - R_d \\end{eqnarray}\\] where \\(A_c\\) [ \\(\\mu\\) mol CO \\(_2\\) m \\(^{-2}\\) s \\(^{-1}\\) ] is the Rubisco-limited CO \\(_2\\) assimilation, \\(A_j\\) [ \\(\\mu\\) mol CO \\(_2\\) m \\(^{-2}\\) s \\(^{-1}\\) ] is the light-limited CO \\(_2\\) assimilation, \\(A_p\\) [ \\(\\mu\\) mol CO \\(_2\\) m \\(^{-2}\\) s \\(^{-1}\\) ] is the PEP carboxylase-limited CO \\(_2\\) assimilation, \\(A_g\\) [ \\(\\mu\\) mol CO \\(_2\\) m \\(^{-2}\\) s \\(^{-1}\\) ] is the co-limited gross CO \\(_2\\) assimilation, and \\(R_d\\) [ \\(\\mu\\) mol CO \\(_2\\) m \\(^{-2}\\) s \\(^{-1}\\) ] is mitochondrial respiration. \\(A_g\\) is given as the smaller of two quadratic roots \\[\\begin{eqnarray} 0.98A^2_i - (A_c + A_j) + A_c A_j &=& 0 \\\\ 0.98A^2_g - (A_i + A_p) + A_i A_p &=& 0 \\end{eqnarray}\\] The assimilation fluxes ( \\(A_c\\) , \\(A_j\\) , and \\(A_p\\) ) for C3 and C4 photosynthesis pathway are described next.","title":"Governing equations"},{"location":"tech_guide/mlc/photosynthesis_biological_demand/#c3-photosynthesis","text":"The CO \\(_2\\) assimilation fluxes for C3 photosynthesis are \\[\\begin{eqnarray} A_c &=& \\frac{V_{cmax} (c_i - \\Gamma^*)}{c_i + K_c(1 - o_i/K_o)}\\\\[0.4em] A_j &=& \\frac{J}{4}\\left( \\frac{c_i - \\Gamma^*}{c_i + 2 \\Gamma^*}\\right) \\\\[0.4em] A_p &=& 0 \\end{eqnarray}\\] where \\(V_{cmax}\\) [ \\(\\mu\\) mol CO \\(_2\\) m \\(^{-2}\\) s \\(^{-1}\\) ] maximum rate of carboxylation, \\(c_i\\) [ \\(\\mu\\) mol CO \\(_2\\) mol \\(^{-1}\\) ] is the intercellular CO \\(_2\\) , \\(o_i\\) [ \\(\\mu\\) mol O \\(_2\\) mol \\(^{-1}\\) ] is the intercellular O \\(_2\\) , \\(K_c\\) [ \\(\\mu\\) mol CO \\(_2\\) mol \\(^{-1}\\) ] is the Michaelist-Mention constant for CO \\(_2\\) , \\(K_o\\) [ \\(\\mu\\) mol O \\(_2\\) mol \\(^{-1}\\) ] is the Michaelist-Mention constant for O \\(_2\\) , \\(J\\) [ \\(\\mu\\) mol CO \\(_2\\) mol \\(^{-1}\\) ] is the electron transport rate, and \\(\\Gamma^*\\) [ \\(\\mu\\) mol CO \\(_2\\) mol \\(^{-1}\\) ] is the compensation point defined as the \\(c_i\\) at which no net CO \\(_2\\) update occurs. The rate of electron transport is related to photosynthetically active radiation and is given as the smaller root of the following quadratic equation. \\[\\begin{equation} \\Theta_j J^2 - (I_{PSII} + J_{max}) + I_{PSII} J_{max} = 0 \\end{equation}\\] where \\(I_{PSII}\\) [ \\(\\mu\\) mol CO \\(_2\\) mol \\(^{-1}\\) ] is the amount of light utilized in photosynthesis II, \\(J_{max}\\) [ \\(\\mu\\) mol CO \\(_2\\) mol \\(^{-1}\\) ] is the maximum transport rate, and \\(\\Theta_j = 0.9\\) is the curvature parameter. The amount of light utilized in photosynthesis II is \\[\\begin{equation} I_{PSII} = \\frac{\\Phi_{PSII}}{2} \\alpha_\\ell \\overrightarrow{I}_{PAR} \\end{equation}\\] where \\(\\Phi_{PSII} = 0.7\\) [mol mol \\(^{-1}\\) ] is the quantum yield of photosystem II, \\(\\alpha_\\ell = 1\\) is the leaf absorptance, \\(\\overrightarrow{I}_{PAR}\\) [ \\(\\mu\\) mol photon m \\(^{-2}\\) s \\(^{-1}\\) ] is the absorbed photosynthetically active radiation. The parameters \\(K_c\\) , \\(K_o\\) , \\(\\Gamma^*\\) , \\(V_{cmax}\\) , \\(J_{max}\\) , and \\(R_d\\) vary from their values at 25 \\(^0\\) C as function of leaf temperature, \\(T_\\ell\\) , that are given as \\[\\begin{eqnarray} K_{c} &=& K_{c25} f(T_\\ell) \\\\[0.4em] K_{o} &=& K_{o25} f(T_\\ell) \\\\[0.4em] \\Gamma^* &=& \\Gamma^* f(T_\\ell) \\\\[0.4em] V_{cmax} &=& V_{cmax25} f(T_\\ell) f_H(T_\\ell)\\\\[0.4em] J_{max} &=& J_{cmax25} f(T_\\ell) f_H(T_\\ell)\\\\[0.4em] R_{d} &=& R_{d25} f(T_\\ell) f_H(T_\\ell) \\end{eqnarray}\\] where \\[\\begin{eqnarray} f(T_\\ell) &=& \\exp \\left[ \\frac{\\Delta H_a}{298.15 \\mathcal{R}} \\left( 1 - \\frac{298.15}{T_\\ell} \\right) \\right] \\\\[0.4em] f_H(T_\\ell) &=& \\left[1 + \\exp \\left( \\frac{298.15\\Delta S - \\Delta H_d}{298.15\\mathcal{R}} \\right) \\right] \\left[1 + \\exp \\left( \\frac{\\Delta S T_\\ell - \\Delta H_d}{\\mathcal{R} T_\\ell} \\right)\\right]^{-1} \\end{eqnarray}\\] Lastly, the \\(J_{max}\\) and \\(R_{d}\\) at 25 \\(^0\\) C are given as \\[\\begin{eqnarray} J_{max25} &=& 1.67 V_{cmax25} \\\\ R_{d25} &=& 0.015 V_{cmax25} \\end{eqnarray}\\]","title":"C3 Photosynthesis"},{"location":"tech_guide/mlc/photosynthesis_biological_demand/#c4-photosynthesis","text":"The CO \\(_2\\) assimilation fluxes for C4 photosynthesis are \\[\\begin{eqnarray} A_c &=& V_{cmax} \\\\ A_j &=& \\alpha_\\ell \\overrightarrow{I}_{PAR} E\\\\ A_p &=& k_p c_i \\end{eqnarray}\\] where \\(E = 0.05\\) [mol mol \\(^{-2}\\) ] is the quantum yield and \\(k_p\\) [mol m \\(^{-2}\\) s \\(^{-1}\\) ] is the initial slope of the CO \\(_2\\) response curve. The temperature dependence of \\(V_{cmax}\\) , \\(R_d\\) , and \\(k_p\\) are given as \\[\\begin{eqnarray} V_{cmax} &=& V_{cmax25} Q_{10}^{(T_\\ell - 298.16)/10} \\left( 1 + \\exp[s_1(T_\\ell - s_2)] \\right)^{-1} \\left( 1 + \\exp[s_3(s_4 - T_\\ell)] \\right)^{-1} \\\\[0.4em] R_d &=& R_{d25} Q_{10}^{(T_\\ell - 298.16)/10} \\left( 1 + \\exp[s_5(s_6 - T_\\ell)] \\right)^{-1} \\\\[0.4em] k_p &=& k_{p25} Q_{10}^{(T_\\ell - 298.16)/10} \\end{eqnarray}\\] where \\(Q_{10} = 2\\) , \\(s_1 = 0.3\\) [K \\(^{-1}\\) ], \\(s_2 = 313.15\\) [K], \\(s_3 = 0.2\\) [K \\(^{-1}\\) ], \\(s_4 = 288.15\\) [K], \\(s_5 = 1.3\\) [K \\(^{-1}\\) ], and \\(s_6 = 328.15\\) [K]. The max \\(R_{d}\\) and \\(k_{p}\\) at 25 \\(^0\\) C are given as \\[\\begin{eqnarray} R_{d25} &=& 0.025 V_{cmax25} \\\\ k_{p25} &=& 0.02 V_{cmax25} \\end{eqnarray}\\]","title":"C4 Photosynthesis"},{"location":"tech_guide/mlc/photosynthesis_diffusion/","text":"Governing equations The net CO \\(_2\\) assimilation due to biological demand must match the diffusion of CO \\(_2\\) from the surrounding air to the leaf surface and into the leaf, and is given by \\[\\begin{equation} \\label{eqn_an_diffusion} A_n = g_{bc} (c_a - c_s) = g_{sc} (c_s - c_i) = g_{\\ell c} (c_a - c_i) \\end{equation}\\] where \\(c_a\\) [ \\(\\mu\\) mol {CO \\(_2\\) } mol \\(^{-1}\\) ] is the atmospheric CO \\(_2\\) , \\(c_s\\) [ \\(\\mu\\) mol CO \\(_2\\) mol \\(^{-1}\\) ] is the leaf surface CO \\(_2\\) , \\(c_i\\) [ \\(\\mu\\) mol CO \\(_2\\) mol \\(^{-1}\\) ] is the intercellular CO \\(_2\\) , \\(g_{bc}\\) [mol m \\(^{-1}\\) s \\(^{-2}\\) o] is the boundary conductance of CO \\(_2\\) , \\(g_{sc}\\) [mol m \\(^{-1}\\) s \\(^{-2}\\) o] is the stomatal conductance of CO \\(_2\\) , and \\(g_{\\ell c}\\) [mol m \\(^{-1}\\) s \\(^{-2}\\) o] is the leaf conductance of CO \\(_2\\) . Similarly, the transpiration of flux, \\(E\\) [mol H \\(_2\\) O m \\(^{-2}\\) o s \\(^{-1}\\) ], is given as \\begin{equation} E = g_{bw} (q_a - q_s) = g_{sw} (q_s - q_i) = g_{\\ell w} (q_a - q_i) \\end{equation} where \\(q_a\\) [ \\(\\mu\\) mol H \\(_2\\) O mol \\(^{-1}\\) ] is the atmospheric H \\(_2\\) O, \\(q_s\\) [ \\(\\mu\\) mol H \\(_2\\) O mol \\(^{-1}\\) ] is the leaf surface H \\(_2\\) O, \\(q_i\\) [ \\(\\mu\\) mol H \\(_2\\) O mol \\(^{-1}\\) ] is the intercellular H \\(_2\\) O, \\(g_{bc}\\) [mol m \\(^{-1}\\) s \\(^{-2}\\) o] is the boundary conductance of H \\(_2\\) O, \\(g_{sc}\\) [mol m \\(^{-1}\\) s \\(^{-2}\\) o] is the stomatal conductance of H \\(_2\\) O, and \\(g_{\\ell c}\\) [mol m \\(^{-1}\\) s \\(^{-2}\\) o] is the leaf conductance of H \\(_2\\) O. The leaf conductances can be written in terms of boundary and stomatal conductances as \\[\\begin{eqnarray} \\label{eqn_glc} g_{\\ell c} &= \\frac{1}{g_{bc}^{-1} + g_{sc}^{-1}} \\\\[0.4em] g_{\\ell w} &= \\frac{1}{g_{bw}^{-1} + g_{sw}^{-1}} \\end{eqnarray}\\] It is assumed that \\(g_{sc} = g_{sw}/1.6\\) . Using equations \\eqref{eqn_an_diffusion} and \\eqref{eqn_glc}, \\(c_i\\) can be given as \\[\\begin{equation} \\label{eqn_ci_diff} c_i = c_a - \\frac{A_n}{g_{\\ell c}} \\end{equation}\\]","title":"Photosynthesis diffusion"},{"location":"tech_guide/mlc/photosynthesis_diffusion/#governing-equations","text":"The net CO \\(_2\\) assimilation due to biological demand must match the diffusion of CO \\(_2\\) from the surrounding air to the leaf surface and into the leaf, and is given by \\[\\begin{equation} \\label{eqn_an_diffusion} A_n = g_{bc} (c_a - c_s) = g_{sc} (c_s - c_i) = g_{\\ell c} (c_a - c_i) \\end{equation}\\] where \\(c_a\\) [ \\(\\mu\\) mol {CO \\(_2\\) } mol \\(^{-1}\\) ] is the atmospheric CO \\(_2\\) , \\(c_s\\) [ \\(\\mu\\) mol CO \\(_2\\) mol \\(^{-1}\\) ] is the leaf surface CO \\(_2\\) , \\(c_i\\) [ \\(\\mu\\) mol CO \\(_2\\) mol \\(^{-1}\\) ] is the intercellular CO \\(_2\\) , \\(g_{bc}\\) [mol m \\(^{-1}\\) s \\(^{-2}\\) o] is the boundary conductance of CO \\(_2\\) , \\(g_{sc}\\) [mol m \\(^{-1}\\) s \\(^{-2}\\) o] is the stomatal conductance of CO \\(_2\\) , and \\(g_{\\ell c}\\) [mol m \\(^{-1}\\) s \\(^{-2}\\) o] is the leaf conductance of CO \\(_2\\) . Similarly, the transpiration of flux, \\(E\\) [mol H \\(_2\\) O m \\(^{-2}\\) o s \\(^{-1}\\) ], is given as \\begin{equation} E = g_{bw} (q_a - q_s) = g_{sw} (q_s - q_i) = g_{\\ell w} (q_a - q_i) \\end{equation} where \\(q_a\\) [ \\(\\mu\\) mol H \\(_2\\) O mol \\(^{-1}\\) ] is the atmospheric H \\(_2\\) O, \\(q_s\\) [ \\(\\mu\\) mol H \\(_2\\) O mol \\(^{-1}\\) ] is the leaf surface H \\(_2\\) O, \\(q_i\\) [ \\(\\mu\\) mol H \\(_2\\) O mol \\(^{-1}\\) ] is the intercellular H \\(_2\\) O, \\(g_{bc}\\) [mol m \\(^{-1}\\) s \\(^{-2}\\) o] is the boundary conductance of H \\(_2\\) O, \\(g_{sc}\\) [mol m \\(^{-1}\\) s \\(^{-2}\\) o] is the stomatal conductance of H \\(_2\\) O, and \\(g_{\\ell c}\\) [mol m \\(^{-1}\\) s \\(^{-2}\\) o] is the leaf conductance of H \\(_2\\) O. The leaf conductances can be written in terms of boundary and stomatal conductances as \\[\\begin{eqnarray} \\label{eqn_glc} g_{\\ell c} &= \\frac{1}{g_{bc}^{-1} + g_{sc}^{-1}} \\\\[0.4em] g_{\\ell w} &= \\frac{1}{g_{bw}^{-1} + g_{sw}^{-1}} \\end{eqnarray}\\] It is assumed that \\(g_{sc} = g_{sw}/1.6\\) . Using equations \\eqref{eqn_an_diffusion} and \\eqref{eqn_glc}, \\(c_i\\) can be given as \\[\\begin{equation} \\label{eqn_ci_diff} c_i = c_a - \\frac{A_n}{g_{\\ell c}} \\end{equation}\\]","title":"Governing equations"},{"location":"tech_guide/mlc/photosynthesis_numerical_solution/","text":"The set of nonlinear equations for photosynthesis model include: biological demand ( see here ), diffusion ( see here ), and stomatal conductance model . The set of nonlinear equations are numerically solved when the residual equation, \\(R(x)\\) , where \\(x\\) is the unknown variable. The solution, \\(x^*\\) , of the nonlinear is obtained when \\(R(x^*) = 0\\) . The residual equation for photosynthesis model with various SCMs is provided below. BB and Medlyn model The unknown variable is \\(c_i\\) and the residual equation is \\[\\begin{equation} \\label{eqn_residual_semiempirical} R(c_i) \\equiv A_n - g_{\\ell c} (c_a - c_i) = 0 \\end{equation}\\] Marginal WUE The unknown variable is \\(g_\\ell\\) and with the residual equation for model without plant hydraulics (i.e. \\(\\xi\\) is independent of \\(\\psi_\\ell\\) ) is \\[\\begin{equation} \\label{eqn_residual_wue} R(g_\\ell) \\equiv \\frac{\\partial A_n}{\\partial g_{sw}} - \\xi = 0 \\end{equation}\\] For models that include plant hydraulics, equation \\eqref{eqn_residual_wue} is modified by making \\(\\xi\\) depend on \\(\\psi_\\ell\\) . iWUE The unknown variable is \\(g_\\ell\\) and with the residual equation for model without plant hydraulics (i.e. \\(\\xi\\) is independent of \\(\\psi_\\ell\\) ) is \\[\\begin{equation} \\label{eqn_residual_iwue} R(g_\\ell) \\equiv \\frac{\\partial A_n}{\\partial g_{sw}} - \\xi w_s = 0 \\end{equation}\\] For models that include plant hydraulics, equation \\eqref{eqn_residual_iwue} is modified by make \\(\\xi\\) depend on \\(\\psi_\\ell\\) . SCM with stomatal dowregulation Depending on the choice of \\(g_{sw,max}\\) ( described here ), the residual equation is given by equation \\eqref{eqn_residual_semiempirical} or \\eqref{eqn_residual_wue} or \\eqref{eqn_residual_iwue}. Original and modified Bonan2014 co-optimization model The unknown variable is \\(g_\\ell\\) and the residual equation for the first constraint is given by equation \\eqref{eqn_residual_wue} or \\eqref{eqn_residual_iwue}. The residual equation for the second constraint is given as \\[\\begin{equation} R(g_\\ell) \\equiv \\psi_{\\ell}^t + \\Delta\\psi_\\ell^{t+\\Delta t} - \\psi_{\\ell, min} = 0 \\end{equation}\\] Wang2020 The unknown variable is \\(g_\\ell\\) and the residual equation is \\[\\begin{equation} R(g_\\ell) \\equiv \\left( 1 - \\frac{E_\\ell}{E_{critical}} \\right) \\frac{\\partial \\Theta}{\\partial E} - \\frac{A_n}{E_{critical}} \\frac{\\partial E_\\ell}{E} = 0 \\end{equation}\\]","title":"Photosynthesis numerical solution"},{"location":"tech_guide/mlc/photosynthesis_numerical_solution/#bb-and-medlyn-model","text":"The unknown variable is \\(c_i\\) and the residual equation is \\[\\begin{equation} \\label{eqn_residual_semiempirical} R(c_i) \\equiv A_n - g_{\\ell c} (c_a - c_i) = 0 \\end{equation}\\]","title":"BB and Medlyn model"},{"location":"tech_guide/mlc/photosynthesis_numerical_solution/#marginal-wue","text":"The unknown variable is \\(g_\\ell\\) and with the residual equation for model without plant hydraulics (i.e. \\(\\xi\\) is independent of \\(\\psi_\\ell\\) ) is \\[\\begin{equation} \\label{eqn_residual_wue} R(g_\\ell) \\equiv \\frac{\\partial A_n}{\\partial g_{sw}} - \\xi = 0 \\end{equation}\\] For models that include plant hydraulics, equation \\eqref{eqn_residual_wue} is modified by making \\(\\xi\\) depend on \\(\\psi_\\ell\\) .","title":"Marginal WUE"},{"location":"tech_guide/mlc/photosynthesis_numerical_solution/#iwue","text":"The unknown variable is \\(g_\\ell\\) and with the residual equation for model without plant hydraulics (i.e. \\(\\xi\\) is independent of \\(\\psi_\\ell\\) ) is \\[\\begin{equation} \\label{eqn_residual_iwue} R(g_\\ell) \\equiv \\frac{\\partial A_n}{\\partial g_{sw}} - \\xi w_s = 0 \\end{equation}\\] For models that include plant hydraulics, equation \\eqref{eqn_residual_iwue} is modified by make \\(\\xi\\) depend on \\(\\psi_\\ell\\) .","title":"iWUE"},{"location":"tech_guide/mlc/photosynthesis_numerical_solution/#scm-with-stomatal-dowregulation","text":"Depending on the choice of \\(g_{sw,max}\\) ( described here ), the residual equation is given by equation \\eqref{eqn_residual_semiempirical} or \\eqref{eqn_residual_wue} or \\eqref{eqn_residual_iwue}.","title":"SCM with stomatal dowregulation"},{"location":"tech_guide/mlc/photosynthesis_numerical_solution/#original-and-modified-bonan2014-co-optimization-model","text":"The unknown variable is \\(g_\\ell\\) and the residual equation for the first constraint is given by equation \\eqref{eqn_residual_wue} or \\eqref{eqn_residual_iwue}. The residual equation for the second constraint is given as \\[\\begin{equation} R(g_\\ell) \\equiv \\psi_{\\ell}^t + \\Delta\\psi_\\ell^{t+\\Delta t} - \\psi_{\\ell, min} = 0 \\end{equation}\\]","title":"Original and modified Bonan2014 co-optimization model"},{"location":"tech_guide/mlc/photosynthesis_numerical_solution/#wang2020","text":"The unknown variable is \\(g_\\ell\\) and the residual equation is \\[\\begin{equation} R(g_\\ell) \\equiv \\left( 1 - \\frac{E_\\ell}{E_{critical}} \\right) \\frac{\\partial \\Theta}{\\partial E} - \\frac{A_n}{E_{critical}} \\frac{\\partial E_\\ell}{E} = 0 \\end{equation}\\]","title":"Wang2020"},{"location":"tech_guide/mlc/photosynthesis_stomatal_conductance_model/","text":"Governing equations The photosynthesis model has two equations ( first and second ) that involves three unknowns ( \\(c_i\\) , \\(A_n\\) , and \\(g_{sw}\\) ). Thus, an additional equation is needed for stomatal conductance to close the system of equations. In the literature, multiple stomatal conductance models (SCMs) have been developed that are based on empirical, semi-empirical, or optimization approach. Furthermore, SMCs can exclude or include plant hydraulics. Semi-empirical models without accounting for plant hydraulics Ball-Berry model The semi-empirical Ball-Berry (BB) SCM 1 is given as \\[\\begin{equation} \\label{eqn_bb} g_{sw} = g_0 + g_1\\frac{A_n}{c_s}h_s \\end{equation}\\] where \\(g_0\\) [mol H \\(_2\\) O m \\(^{-2}\\) s \\(^{-1}\\) ] is the minimum stomatal conductance, \\(g_1\\) [mol H \\(_2\\) O m \\(^{-2}\\) s \\(^{-1}\\) ] is the slope of the relationship, and $h_s $ [-] is the fractional humidity at the leaf surface. The fractional humidity at the leaf surface is \\(h_s = e_s/e_{sat}(T_\\ell)\\) where \\(e_s\\) and \\(e_{sat}(T_\\ell)\\) are the vapor pressure at the leaf surface and saturated vapor pressure at leaf temperature, \\(T_\\ell\\) , respectively. The vapor pressure at leaf surface can be given as \\[\\begin{equation} \\label{eqn_vp_leaf} e_s = \\frac{g_{bw}e_a + g_{sw} e_{sat}(T_\\ell) }{g_{bw} + g_{sw}} \\end{equation}\\] Substituting equation \\eqref{eqn_vp_leaf} in equation \\eqref{eqn_bb} leads the following quadratic equation in which \\(g_{sw}\\) is the larger root of the equation. \\[\\begin{equation} \\alpha g_{sw}^2 + \\beta g_{sw} + \\gamma = 0 \\end{equation}\\] where \\[\\begin{eqnarray} \\alpha &=& 1 \\\\ \\beta &=& g_{gw} - g_0 - \\frac{g_1 A_n}{c_s} \\\\ \\gamma &=& - g_{bw} \\left[ g_0 + \\frac{g_1 A_n e_a}{c_s e_{sat}(T_\\ell)} \\right] \\end{eqnarray}\\] Medlyn model The semi-empirical Medlyn SCM 2 is given as \\[\\begin{equation} \\label{eqn_medlyn} g_{sw} = g_0 + 1.6\\frac{A_n}{c_s} \\left( 1 + \\frac{g_1}{\\sqrt D_s}\\right) \\end{equation}\\] where \\(g_0\\) [mol H \\(_2\\) O m \\(^{-2}\\) s \\(^{-1}\\) ] is the minimum stomatal conductance, \\(g_1\\) [mol H \\(_2\\) O m \\(^{-2}\\) s \\(^{-1}\\) ] is the slope of the relationship, and \\(D_s = (e_{sat}(T_\\ell) - e_s)\\) [KPa] is the vapor pressure deficit. Similar to BB model, substituting equation \\eqref{eqn_vp_leaf} in equation \\eqref{eqn_medlyn} leads to following quadratic equations, whose larger root is \\(g_{sw}\\) . \\[\\begin{equation} \\alpha g_{sw}^2 + \\beta g_{sw} + \\gamma = 0 \\end{equation}\\] where \\[\\begin{eqnarray} \\alpha &=& 1 \\\\ \\beta &=& - 2 \\left( g_{0} - 1.6\\frac{g_1 A_n}{c_s}\\right) - \\left( \\frac{1.6 A_n g_1}{c_s} \\right)^2 \\frac{1}{g_{bw} D_\\ell} \\\\ \\gamma &=& - \\left[ 2g_0 + \\frac{1.6A_n}{c_s} \\left( 1 - \\frac{g_\\ell^2}{D_\\ell} \\right) \\right] \\frac{1.6 A_n g_1}{c_s} \\end{eqnarray}\\] with \\(D_\\ell = e_{sat}(T_\\ell) - e_a\\) . Optimization-based models Optimization-based SCMs maximize carbon update, \\(A_n\\) , while minimizing the cost associated with carbon update, \\(\\Theta\\) , related a measure of stomatal opening, \\(\\chi\\) 3 . Such models can be formulated as \\[\\begin{equation} \\label{eqn_opt_obj_fn} \\begin{aligned} \\max_{\\chi} \\quad & (A_n - \\Theta) \\end{aligned} \\end{equation}\\] and the solution of equation \\eqref{eqn_opt_obj_fn} is obtained by finding \\(\\chi\\) that satisfies the following equation \\[\\begin{equation} \\label{eqn_opt_soln} \\frac{\\partial A_n}{\\partial \\chi} - \\frac{\\partial \\Theta}{\\partial \\chi} = 0 \\end{equation}\\] Marginal water-use efficiency (WUE) model without accounting for plant hydraulics In this model, \\(\\chi = E\\) and \\(\\Theta = \\xi E\\) , where \\(\\xi\\) is a constant model parameter. Thus, equation \\eqref{eqn_opt_soln} reduces to \\[\\begin{equation} \\label{eqn_wue} \\frac{\\partial A_n}{\\partial E} = \\xi \\end{equation}\\] The LHS term of equation \\eqref{eqn_wue} can be derived 4 as \\begin{equation} \\frac{\\partial A_n}{\\partial E} = \\left( \\frac{c_a - c_i}{w_l} \\right) \\left( \\frac{ \\partial A_n/\\partial c_i}{\\partial A_n/\\partial c_i + g_{lc}} \\right) 1.6 \\frac{g_{lc}^2}{g_{\\ell w}^2} \\end{equation} where \\(w_\\ell = \\left[ e_{sat}(T_\\ell) - e_a \\right]/P_{ref}\\) [mol mol \\(^{-1}\\) ] is the vapor pressure deficit. Intrinsic WUE (iWUE) model without accounting for plant hydraulics In this model, \\(\\chi = g_{sw}\\) and the cost function is similar to that of the WUE model (i.e. \\(\\Theta = \\xi E\\) ). The equation \\eqref{eqn_opt_soln} then reduces to \\begin{equation} \\label{eqn_iwue} \\begin{split} \\frac{\\partial A_n}{\\partial g_{sw}} &= \\xi \\frac{\\partial E}{\\partial g_{sw}} \\ &= \\xi \\frac{\\partial}{\\partial g_{sw}} \\left( \\frac{(e_{sat}(T_\\ell) - e_s ) g_{sw} }{P_{ref}} \\right) \\ &\\approx \\xi w_s \\end{split} \\end{equation} where \\(w_s (= [e_{sat}(T_\\ell) - e_s]/P_{ref})\\) [mol mol \\(^{-1}\\) ] is the water vapor deficit at the leaf surface. In equation \\eqref{eqn_iwue}, the term \\(\\partial e_s/\\partial g_{sw}\\) is neglected. WUE model including plant hydraulics The marginal WUE model can be modified to account for loss of xylem conductivity by including dependence of \\(\\xi\\) in equation \\eqref{eqn_wue} on leaf water potential 5 as \\[\\begin{equation} \\xi(\\psi_\\ell) = \\exp(\\beta \\psi_\\ell) \\end{equation}\\] where \\(\\beta\\) is a model parameter. Co-optimization model of Bonan2014 Bonan2014 6 is a SCM that maximizes \\(g_{sw}\\) while satisfying two constraints: (1) WUE or iWUE is greater than a threshold (i.e. \\(\\partial A_n/\\partial E \\ge \\xi\\) or \\((\\partial A_n/\\partial g_{sw})/w_s \\ge \\xi\\) , and (2) leaf water potential is greater than a threshold (i.e. \\(\\psi_\\ell \\ge \\psi_{\\ell, min})\\) . The plant hydraulics model assumes leaves (sunlit or shaded) at any height are directly connected to multiple soil layers via a root system. The leaf water storage is given by \\[\\begin{equation} \\label{eqn_bonan14_phm} \\frac{d\\psi_\\ell}{dt} = \\frac{K_L (\\psi_s - \\psi_\\ell - \\rho_wgh) - 10^3 \\times E}{C_p} \\end{equation}\\] where \\(\\psi_\\ell\\) [MPa] is the leaf water potential, \\(\\psi_s\\) [MPa] is the soil water potential, \\(\\rho_wgh\\) [MPa] is the gravitational head, \\(C_p\\) [ \\(\\mu\\) mol H \\(_2\\) O { }m \\(^{-2}_\\ell\\) MPa \\(^{-1}\\) ] is the leaf capacitance, and \\(K_L\\) [ \\(\\mu\\) mol H \\(_2\\) O { }m \\(^{-2}_\\ell\\) s \\(^{-1}\\) MPa \\(^{-1}\\) ] is the whole plant hydraulic conductance, and \\(E\\) [mmol H \\(_2\\) O { }m \\(^{-2}_\\ell\\) s \\(^{-1}\\) ] is the transpiration flux. The \\(K_L\\) is independent of \\(\\psi_l\\) and thus integrating equation \\ref{eqn_bonan14_phm} provides an analytical expression for the change of leaf water potential, \\(\\Delta \\psi_\\ell^{t+\\Delta t}\\) , for time step, \\(\\Delta t\\) , as \\[\\begin{equation} \\Delta\\psi_\\ell^{t+\\Delta t} = \\left[ \\psi_s - \\psi_\\ell^{t} - \\rho_w g h - \\frac{10^3 \\times E}{K_L}\\right] \\left( 1 - e^{-K_L\\Delta t/C_p}\\right) \\end{equation}\\] The second constraint of the co-optimization approach leads to \\[\\begin{equation} \\psi_{\\ell}^t + \\Delta\\psi_\\ell^{t+\\Delta t} \\ge \\psi_{\\ell, min} \\end{equation}\\] The whole plant hydraulic conductance depends on soil-to-stem conductance, \\(K_{L,s2s}\\) [ \\(\\mu\\) mol H \\(_2\\) O { }m \\(^{-2}_\\ell\\) s \\(^{-1}\\) MPa \\(^{-1}\\) ], and stem-to-leave conductance, \\(K_{L,s2\\ell}\\) [ \\(\\mu\\) mol H \\(_2\\) O { }m \\(^{-2}_\\ell\\) s \\(^{-1}\\) MPa \\(^{-1}\\) ] as \\[\\begin{equation} \\frac{1}{K_L} = \\frac{1}{K_{L,s2s}} + \\frac{1}{K_{L,s2\\ell}} \\end{equation}\\] Modified Bonan2014 model In this study, we have developed a modified plant hydraulic model of Bonan2014 by including dependence of leaf water potential on stem-to-soil conductance, which is modeled by a Weibull function as \\begin{equation} K_{L,s2\\ell}(\\psi_\\ell) = \\psi_{L,s2\\ell}^{max} \\exp \\left[ \\left(\\frac{-\\psi_{\\ell}}{b}\\right)^c \\right] \\end{equation} where \\(b\\) [MPa] and \\(c\\) [-] are parameters. The modified equation \\eqref{eqn_bonan14_phm} is solved using the forward Euler time-integration scheme. Wang2020 model In Wang2020 model 3 , \\(\\chi = E\\) and the cost function is given as \\[\\begin{equation} \\Theta = A_n\\frac{E_{\\ell}}{E_{critical}} \\end{equation}\\] Semi-empirical model with downregulation due to plant hydraulics Empirical models have been proposed for reducing \\(g_{sw}\\) to account for loss of xylem hydraulic conductivity with water potential. Examples of such empirical stomatal downregulation models include equation \\eqref{eqn_chris} 7 and equation \\eqref{eqn_bohrer} 8 . \\[\\begin{eqnarray} g_{sw} &=& g_{sw,max} \\left[ 1 + \\left(\\frac{-\\psi_{\\ell}}{\\psi_{50}}\\right)^a \\right]^{-1} \\label{eqn_chris}\\\\ g_{sw} &=& g_{sw,max} \\exp \\left[ -\\left( \\frac{\\psi_{\\ell}}{\\psi_{50}}\\right)^a \\right] \\label{eqn_bohrer} \\end{eqnarray}\\] where \\(a\\) [-] and \\(\\psi_{50}\\) [KPa] are model parameters. In these empirical stomatal downregulation models, \\(g_{sw,max}\\) is obtained from equation \\ref{eqn_bb} or \\ref{eqn_medlyn} or \\ref{eqn_wue} or \\ref{eqn_iwue}. J Timothy Ball, Ian E Woodrow, and Joseph A Berry. A model predicting stomatal conductance and its contribution to the control of photosynthesis under different environmental conditions. In Progress in photosynthesis research: volume 4 proceedings of the VIIth international congress on photosynthesis providence, Rhode Island, USA, august 10\u201315, 1986 , 221\u2013224. Springer, 1987. \u21a9 Belinda E Medlyn, Remko A Duursma, Derek Eamus, David S Ellsworth, I Colin Prentice, Craig VM Barton, Kristine Y Crous, Paolo De Angelis, Michael Freeman, and Lisa Wingate. Reconciling the optimal and empirical approaches to modelling stomatal conductance. Global Change Biology , 17(6):2134\u20132144, 2011. \u21a9 Yujie Wang, John S Sperry, William RL Anderegg, Martin D Venturas, and Anna T Trugman. A theoretical and empirical assessment of stomatal optimization modeling. New Phytologist , 227(2):311\u2013325, 2020. \u21a9 \u21a9 Thomas N Buckley, Lawren Sack, and Graham D Farquhar. Optimal plant water economy. Plant, cell & environment , 40(6):881\u2013896, 2017. \u21a9 Stefano Manzoni, Giulia Vico, Gabriel Katul, Philip A Fay, Wayne Polley, Sari Palmroth, and Amilcare Porporato. Optimizing stomatal conductance for maximum carbon gain under water stress: a meta-analysis across plant functional types and climates. Functional Ecology , 25(3):456\u2013467, 2011. \u21a9 GB Bonan, Mathew Williams, RA Fisher, and KW Oleson. Modeling stomatal conductance in the earth system: linking leaf water-use efficiency and water transport along the soil\u2013plant\u2013atmosphere continuum. Geoscientific Model Development , 7(5):2193\u20132222, 2014. \u21a9 Bradley O Christoffersen, Manuel Gloor, Sophie Fauset, Nikolaos M Fyllas, David R Galbraith, Timothy R Baker, Bart Kruijt, Lucy Rowland, Rosie A Fisher, Oliver J Binks, and others. Linking hydraulic traits to tropical forest function in a size-structured and trait-driven model (tfs v. 1-hydro). Geoscientific Model Development , 9(11):4227\u20134255, 2016. \u21a9 Gil Bohrer, Hashem Mourad, Tod A Laursen, Darren Drewry, Roni Avissar, Davide Poggi, Ram Oren, and Gabriel G Katul. Finite element tree crown hydrodynamics model (fetch) using porous media flow within branching elements: a new representation of tree hydrodynamics. Water Resources Research , 2005. \u21a9","title":"Photosynthesis stomatal conductance model"},{"location":"tech_guide/mlc/photosynthesis_stomatal_conductance_model/#governing-equations","text":"The photosynthesis model has two equations ( first and second ) that involves three unknowns ( \\(c_i\\) , \\(A_n\\) , and \\(g_{sw}\\) ). Thus, an additional equation is needed for stomatal conductance to close the system of equations. In the literature, multiple stomatal conductance models (SCMs) have been developed that are based on empirical, semi-empirical, or optimization approach. Furthermore, SMCs can exclude or include plant hydraulics.","title":"Governing equations"},{"location":"tech_guide/mlc/photosynthesis_stomatal_conductance_model/#semi-empirical-models-without-accounting-for-plant-hydraulics","text":"","title":"Semi-empirical models without accounting for plant hydraulics"},{"location":"tech_guide/mlc/photosynthesis_stomatal_conductance_model/#ball-berry-model","text":"The semi-empirical Ball-Berry (BB) SCM 1 is given as \\[\\begin{equation} \\label{eqn_bb} g_{sw} = g_0 + g_1\\frac{A_n}{c_s}h_s \\end{equation}\\] where \\(g_0\\) [mol H \\(_2\\) O m \\(^{-2}\\) s \\(^{-1}\\) ] is the minimum stomatal conductance, \\(g_1\\) [mol H \\(_2\\) O m \\(^{-2}\\) s \\(^{-1}\\) ] is the slope of the relationship, and $h_s $ [-] is the fractional humidity at the leaf surface. The fractional humidity at the leaf surface is \\(h_s = e_s/e_{sat}(T_\\ell)\\) where \\(e_s\\) and \\(e_{sat}(T_\\ell)\\) are the vapor pressure at the leaf surface and saturated vapor pressure at leaf temperature, \\(T_\\ell\\) , respectively. The vapor pressure at leaf surface can be given as \\[\\begin{equation} \\label{eqn_vp_leaf} e_s = \\frac{g_{bw}e_a + g_{sw} e_{sat}(T_\\ell) }{g_{bw} + g_{sw}} \\end{equation}\\] Substituting equation \\eqref{eqn_vp_leaf} in equation \\eqref{eqn_bb} leads the following quadratic equation in which \\(g_{sw}\\) is the larger root of the equation. \\[\\begin{equation} \\alpha g_{sw}^2 + \\beta g_{sw} + \\gamma = 0 \\end{equation}\\] where \\[\\begin{eqnarray} \\alpha &=& 1 \\\\ \\beta &=& g_{gw} - g_0 - \\frac{g_1 A_n}{c_s} \\\\ \\gamma &=& - g_{bw} \\left[ g_0 + \\frac{g_1 A_n e_a}{c_s e_{sat}(T_\\ell)} \\right] \\end{eqnarray}\\]","title":"Ball-Berry model"},{"location":"tech_guide/mlc/photosynthesis_stomatal_conductance_model/#medlyn-model","text":"The semi-empirical Medlyn SCM 2 is given as \\[\\begin{equation} \\label{eqn_medlyn} g_{sw} = g_0 + 1.6\\frac{A_n}{c_s} \\left( 1 + \\frac{g_1}{\\sqrt D_s}\\right) \\end{equation}\\] where \\(g_0\\) [mol H \\(_2\\) O m \\(^{-2}\\) s \\(^{-1}\\) ] is the minimum stomatal conductance, \\(g_1\\) [mol H \\(_2\\) O m \\(^{-2}\\) s \\(^{-1}\\) ] is the slope of the relationship, and \\(D_s = (e_{sat}(T_\\ell) - e_s)\\) [KPa] is the vapor pressure deficit. Similar to BB model, substituting equation \\eqref{eqn_vp_leaf} in equation \\eqref{eqn_medlyn} leads to following quadratic equations, whose larger root is \\(g_{sw}\\) . \\[\\begin{equation} \\alpha g_{sw}^2 + \\beta g_{sw} + \\gamma = 0 \\end{equation}\\] where \\[\\begin{eqnarray} \\alpha &=& 1 \\\\ \\beta &=& - 2 \\left( g_{0} - 1.6\\frac{g_1 A_n}{c_s}\\right) - \\left( \\frac{1.6 A_n g_1}{c_s} \\right)^2 \\frac{1}{g_{bw} D_\\ell} \\\\ \\gamma &=& - \\left[ 2g_0 + \\frac{1.6A_n}{c_s} \\left( 1 - \\frac{g_\\ell^2}{D_\\ell} \\right) \\right] \\frac{1.6 A_n g_1}{c_s} \\end{eqnarray}\\] with \\(D_\\ell = e_{sat}(T_\\ell) - e_a\\) .","title":"Medlyn model"},{"location":"tech_guide/mlc/photosynthesis_stomatal_conductance_model/#optimization-based-models","text":"Optimization-based SCMs maximize carbon update, \\(A_n\\) , while minimizing the cost associated with carbon update, \\(\\Theta\\) , related a measure of stomatal opening, \\(\\chi\\) 3 . Such models can be formulated as \\[\\begin{equation} \\label{eqn_opt_obj_fn} \\begin{aligned} \\max_{\\chi} \\quad & (A_n - \\Theta) \\end{aligned} \\end{equation}\\] and the solution of equation \\eqref{eqn_opt_obj_fn} is obtained by finding \\(\\chi\\) that satisfies the following equation \\[\\begin{equation} \\label{eqn_opt_soln} \\frac{\\partial A_n}{\\partial \\chi} - \\frac{\\partial \\Theta}{\\partial \\chi} = 0 \\end{equation}\\]","title":"Optimization-based models"},{"location":"tech_guide/mlc/photosynthesis_stomatal_conductance_model/#marginal-water-use-efficiency-wue-model-without-accounting-for-plant-hydraulics","text":"In this model, \\(\\chi = E\\) and \\(\\Theta = \\xi E\\) , where \\(\\xi\\) is a constant model parameter. Thus, equation \\eqref{eqn_opt_soln} reduces to \\[\\begin{equation} \\label{eqn_wue} \\frac{\\partial A_n}{\\partial E} = \\xi \\end{equation}\\] The LHS term of equation \\eqref{eqn_wue} can be derived 4 as \\begin{equation} \\frac{\\partial A_n}{\\partial E} = \\left( \\frac{c_a - c_i}{w_l} \\right) \\left( \\frac{ \\partial A_n/\\partial c_i}{\\partial A_n/\\partial c_i + g_{lc}} \\right) 1.6 \\frac{g_{lc}^2}{g_{\\ell w}^2} \\end{equation} where \\(w_\\ell = \\left[ e_{sat}(T_\\ell) - e_a \\right]/P_{ref}\\) [mol mol \\(^{-1}\\) ] is the vapor pressure deficit.","title":"Marginal water-use efficiency (WUE) model without accounting for plant hydraulics"},{"location":"tech_guide/mlc/photosynthesis_stomatal_conductance_model/#intrinsic-wue-iwue-model-without-accounting-for-plant-hydraulics","text":"In this model, \\(\\chi = g_{sw}\\) and the cost function is similar to that of the WUE model (i.e. \\(\\Theta = \\xi E\\) ). The equation \\eqref{eqn_opt_soln} then reduces to \\begin{equation} \\label{eqn_iwue} \\begin{split} \\frac{\\partial A_n}{\\partial g_{sw}} &= \\xi \\frac{\\partial E}{\\partial g_{sw}} \\ &= \\xi \\frac{\\partial}{\\partial g_{sw}} \\left( \\frac{(e_{sat}(T_\\ell) - e_s ) g_{sw} }{P_{ref}} \\right) \\ &\\approx \\xi w_s \\end{split} \\end{equation} where \\(w_s (= [e_{sat}(T_\\ell) - e_s]/P_{ref})\\) [mol mol \\(^{-1}\\) ] is the water vapor deficit at the leaf surface. In equation \\eqref{eqn_iwue}, the term \\(\\partial e_s/\\partial g_{sw}\\) is neglected.","title":"Intrinsic WUE (iWUE) model without accounting for plant hydraulics"},{"location":"tech_guide/mlc/photosynthesis_stomatal_conductance_model/#wue-model-including-plant-hydraulics","text":"The marginal WUE model can be modified to account for loss of xylem conductivity by including dependence of \\(\\xi\\) in equation \\eqref{eqn_wue} on leaf water potential 5 as \\[\\begin{equation} \\xi(\\psi_\\ell) = \\exp(\\beta \\psi_\\ell) \\end{equation}\\] where \\(\\beta\\) is a model parameter.","title":"WUE model including plant hydraulics"},{"location":"tech_guide/mlc/photosynthesis_stomatal_conductance_model/#co-optimization-model-of-bonan2014","text":"Bonan2014 6 is a SCM that maximizes \\(g_{sw}\\) while satisfying two constraints: (1) WUE or iWUE is greater than a threshold (i.e. \\(\\partial A_n/\\partial E \\ge \\xi\\) or \\((\\partial A_n/\\partial g_{sw})/w_s \\ge \\xi\\) , and (2) leaf water potential is greater than a threshold (i.e. \\(\\psi_\\ell \\ge \\psi_{\\ell, min})\\) . The plant hydraulics model assumes leaves (sunlit or shaded) at any height are directly connected to multiple soil layers via a root system. The leaf water storage is given by \\[\\begin{equation} \\label{eqn_bonan14_phm} \\frac{d\\psi_\\ell}{dt} = \\frac{K_L (\\psi_s - \\psi_\\ell - \\rho_wgh) - 10^3 \\times E}{C_p} \\end{equation}\\] where \\(\\psi_\\ell\\) [MPa] is the leaf water potential, \\(\\psi_s\\) [MPa] is the soil water potential, \\(\\rho_wgh\\) [MPa] is the gravitational head, \\(C_p\\) [ \\(\\mu\\) mol H \\(_2\\) O { }m \\(^{-2}_\\ell\\) MPa \\(^{-1}\\) ] is the leaf capacitance, and \\(K_L\\) [ \\(\\mu\\) mol H \\(_2\\) O { }m \\(^{-2}_\\ell\\) s \\(^{-1}\\) MPa \\(^{-1}\\) ] is the whole plant hydraulic conductance, and \\(E\\) [mmol H \\(_2\\) O { }m \\(^{-2}_\\ell\\) s \\(^{-1}\\) ] is the transpiration flux. The \\(K_L\\) is independent of \\(\\psi_l\\) and thus integrating equation \\ref{eqn_bonan14_phm} provides an analytical expression for the change of leaf water potential, \\(\\Delta \\psi_\\ell^{t+\\Delta t}\\) , for time step, \\(\\Delta t\\) , as \\[\\begin{equation} \\Delta\\psi_\\ell^{t+\\Delta t} = \\left[ \\psi_s - \\psi_\\ell^{t} - \\rho_w g h - \\frac{10^3 \\times E}{K_L}\\right] \\left( 1 - e^{-K_L\\Delta t/C_p}\\right) \\end{equation}\\] The second constraint of the co-optimization approach leads to \\[\\begin{equation} \\psi_{\\ell}^t + \\Delta\\psi_\\ell^{t+\\Delta t} \\ge \\psi_{\\ell, min} \\end{equation}\\] The whole plant hydraulic conductance depends on soil-to-stem conductance, \\(K_{L,s2s}\\) [ \\(\\mu\\) mol H \\(_2\\) O { }m \\(^{-2}_\\ell\\) s \\(^{-1}\\) MPa \\(^{-1}\\) ], and stem-to-leave conductance, \\(K_{L,s2\\ell}\\) [ \\(\\mu\\) mol H \\(_2\\) O { }m \\(^{-2}_\\ell\\) s \\(^{-1}\\) MPa \\(^{-1}\\) ] as \\[\\begin{equation} \\frac{1}{K_L} = \\frac{1}{K_{L,s2s}} + \\frac{1}{K_{L,s2\\ell}} \\end{equation}\\]","title":"Co-optimization model of Bonan2014"},{"location":"tech_guide/mlc/photosynthesis_stomatal_conductance_model/#modified-bonan2014-model","text":"In this study, we have developed a modified plant hydraulic model of Bonan2014 by including dependence of leaf water potential on stem-to-soil conductance, which is modeled by a Weibull function as \\begin{equation} K_{L,s2\\ell}(\\psi_\\ell) = \\psi_{L,s2\\ell}^{max} \\exp \\left[ \\left(\\frac{-\\psi_{\\ell}}{b}\\right)^c \\right] \\end{equation} where \\(b\\) [MPa] and \\(c\\) [-] are parameters. The modified equation \\eqref{eqn_bonan14_phm} is solved using the forward Euler time-integration scheme.","title":"Modified Bonan2014 model"},{"location":"tech_guide/mlc/photosynthesis_stomatal_conductance_model/#wang2020-model","text":"In Wang2020 model 3 , \\(\\chi = E\\) and the cost function is given as \\[\\begin{equation} \\Theta = A_n\\frac{E_{\\ell}}{E_{critical}} \\end{equation}\\]","title":"Wang2020 model"},{"location":"tech_guide/mlc/photosynthesis_stomatal_conductance_model/#semi-empirical-model-with-downregulation-due-to-plant-hydraulics","text":"Empirical models have been proposed for reducing \\(g_{sw}\\) to account for loss of xylem hydraulic conductivity with water potential. Examples of such empirical stomatal downregulation models include equation \\eqref{eqn_chris} 7 and equation \\eqref{eqn_bohrer} 8 . \\[\\begin{eqnarray} g_{sw} &=& g_{sw,max} \\left[ 1 + \\left(\\frac{-\\psi_{\\ell}}{\\psi_{50}}\\right)^a \\right]^{-1} \\label{eqn_chris}\\\\ g_{sw} &=& g_{sw,max} \\exp \\left[ -\\left( \\frac{\\psi_{\\ell}}{\\psi_{50}}\\right)^a \\right] \\label{eqn_bohrer} \\end{eqnarray}\\] where \\(a\\) [-] and \\(\\psi_{50}\\) [KPa] are model parameters. In these empirical stomatal downregulation models, \\(g_{sw,max}\\) is obtained from equation \\ref{eqn_bb} or \\ref{eqn_medlyn} or \\ref{eqn_wue} or \\ref{eqn_iwue}. J Timothy Ball, Ian E Woodrow, and Joseph A Berry. A model predicting stomatal conductance and its contribution to the control of photosynthesis under different environmental conditions. In Progress in photosynthesis research: volume 4 proceedings of the VIIth international congress on photosynthesis providence, Rhode Island, USA, august 10\u201315, 1986 , 221\u2013224. Springer, 1987. \u21a9 Belinda E Medlyn, Remko A Duursma, Derek Eamus, David S Ellsworth, I Colin Prentice, Craig VM Barton, Kristine Y Crous, Paolo De Angelis, Michael Freeman, and Lisa Wingate. Reconciling the optimal and empirical approaches to modelling stomatal conductance. Global Change Biology , 17(6):2134\u20132144, 2011. \u21a9 Yujie Wang, John S Sperry, William RL Anderegg, Martin D Venturas, and Anna T Trugman. A theoretical and empirical assessment of stomatal optimization modeling. New Phytologist , 227(2):311\u2013325, 2020. \u21a9 \u21a9 Thomas N Buckley, Lawren Sack, and Graham D Farquhar. Optimal plant water economy. Plant, cell & environment , 40(6):881\u2013896, 2017. \u21a9 Stefano Manzoni, Giulia Vico, Gabriel Katul, Philip A Fay, Wayne Polley, Sari Palmroth, and Amilcare Porporato. Optimizing stomatal conductance for maximum carbon gain under water stress: a meta-analysis across plant functional types and climates. Functional Ecology , 25(3):456\u2013467, 2011. \u21a9 GB Bonan, Mathew Williams, RA Fisher, and KW Oleson. Modeling stomatal conductance in the earth system: linking leaf water-use efficiency and water transport along the soil\u2013plant\u2013atmosphere continuum. Geoscientific Model Development , 7(5):2193\u20132222, 2014. \u21a9 Bradley O Christoffersen, Manuel Gloor, Sophie Fauset, Nikolaos M Fyllas, David R Galbraith, Timothy R Baker, Bart Kruijt, Lucy Rowland, Rosie A Fisher, Oliver J Binks, and others. Linking hydraulic traits to tropical forest function in a size-structured and trait-driven model (tfs v. 1-hydro). Geoscientific Model Development , 9(11):4227\u20134255, 2016. \u21a9 Gil Bohrer, Hashem Mourad, Tod A Laursen, Darren Drewry, Roni Avissar, Davide Poggi, Ram Oren, and Gabriel G Katul. Finite element tree crown hydrodynamics model (fetch) using porous media flow within branching elements: a new representation of tree hydrodynamics. Water Resources Research , 2005. \u21a9","title":"Semi-empirical model with downregulation due to plant hydraulics"},{"location":"tech_guide/mlc/roughness_sublayer_model/","text":"Wind profile above canopy The wind profile, \\(u\\) , above canopy the is given as \\[\\begin{equation} \\label{eqn_du_dz_above} \\frac{\\kappa (z-d)}{u_* }\\frac{\\partial u }{\\partial z} = \\Phi_m\\left( z \\right) \\end{equation}\\] where \\(\\Phi_m\\) [-] is an effective similarity function that is given by \\[\\begin{equation} \\label{eqn_phi_m} \\Phi_m(z) = \\phi_m \\left( \\frac{z-d}{L_{MO}}\\right) \\hat{\\phi}_m \\left( \\frac{z-d}{l_m /\\beta }\\right) \\end{equation}\\] \\[\\begin{equation} u(z) = \\frac{u_*}{\\kappa} \\left[ \\ln \\left( \\frac{z - d}{z_{0m}} \\right) - \\psi_m\\left( \\frac{z - d}{L_{MO}} \\right) + \\psi_m\\left( \\frac{z_{0m}}{L_{MO}} \\right) + \\hat{\\psi}_m(z) \\right] \\end{equation}\\] where \\[\\begin{equation} \\label{eqn:wind_profile_rsl_above} \\hat{\\psi}_m = \\int_z^\\infty \\phi_m \\left( \\frac{z' - d}{L_{MO}} \\right) \\left[ 1 - \\hat{\\phi}_m \\left(\\frac{z' -d }{l_m/\\beta} \\right) \\right] \\frac{dz'}{z' - d} \\end{equation}\\] Given equation \\eqref{eqn:wind_profile_rsl_above}, the wind at canopy height is given by \\[\\begin{equation} \\label{eqn:wind_at_hc} u_{hc} = \\frac{u_*}{\\beta} \\end{equation}\\] \\[\\begin{eqnarray} u(z) &=& \\frac{u_*}{\\kappa} \\left[ \\ln \\left( \\frac{z - d}{h_c - d} \\right) - \\psi_m\\left( \\frac{z - d}{L_{MO}} \\right) + \\psi_m\\left( \\frac{h_c - d}{L_{MO}} \\right) \\right. \\nonumber \\\\ & & \\label{eqn_u_with_hc} \\left. + \\hat{\\psi_m}(z) - \\hat{\\psi_m}(h_c) + \\frac{\\kappa}{\\beta} \\right] \\end{eqnarray}\\] Wind profile within canopy HF-2007 assumed an exponential wind profile within the canopy that is given as \\[\\begin{equation} \\label{eqn_du_dz_within} u(z) = u(h_c)\\exp\\left( \\frac{z - h_c}{l_m/\\beta} \\right) \\end{equation}\\] and the derivative of the wind profile is \\[\\begin{eqnarray} \\frac{\\partial u(z)}{\\partial z} &=& \\frac{u(h_c)}{l_m/\\beta} \\exp\\left( \\frac{z - h_c}{l_m/\\beta} \\right) \\nonumber \\\\ &=& \\frac{u(z)}{l_m/\\beta} \\end{eqnarray}\\] \\[\\begin{equation} h_c - d = \\frac{l_m}{2\\beta} = \\beta^2 L_c \\end{equation}\\] Enforcing the continuity of derivative of wind at canopy height ( \\(h_c\\) ) from equation \\eqref{eqn_du_dz_above} and \\eqref{eqn_du_dz_within} leads to \\[\\begin{eqnarray} \\frac{u_*}{\\kappa (h_c - d)} \\Phi_m(h_c) &=& \\frac{u(h_c)}{l_m/\\beta} \\nonumber \\\\ \\Phi_m(h_c) &=& \\frac{u(h_c)}{u_*} \\times \\frac{\\kappa (h_c - d)}{l_m/\\beta} \\nonumber \\\\ \\Phi_m(h_c) &=& \\frac{1}{\\beta} \\times \\frac{\\kappa l_m/(2\\beta) }{l_m/\\beta} \\nonumber \\\\ \\label{eqn_phi_m_at_hc} \\Phi_m(h_c) &=& \\frac{\\kappa l_m}{2\\beta} \\end{eqnarray}\\] Wind similarity function For the above canopy wind profile, HF-2007 assumed the similarity function for momentum to be \\[\\begin{equation} \\hat{\\phi}_m \\left( \\frac{z-d}{l_m /\\beta} \\right) = 1 - c_1 \\exp \\left[ -c_2 \\left( \\frac{z-d}{l_m/\\beta} \\right)\\right] \\end{equation}\\] where \\(c_1\\) and \\(c_2 (= 0.5)\\) are parameters. The parameter \\(c_1\\) is found by evaluating \\(\\hat{\\phi}_m\\) at \\(z=h_c\\) that gives \\[\\begin{eqnarray} \\hat{\\phi}_m \\left( \\frac{h_c - d}{l_m /\\beta} \\right) &=& 1 - c_1 \\exp \\left[ -c_2 \\left( \\frac{h_c-d}{l_m/\\beta} \\right)\\right] \\nonumber \\\\ &=& 1 - c_1 \\exp \\left[ -c_2 \\left( \\frac{l_m/(2\\beta)}{l_m/\\beta} \\right)\\right] \\nonumber \\\\ &=& 1 - c_1 \\exp \\left( -0.5c_2\\right) \\nonumber \\\\ c_1 &=& \\left[ 1 - \\hat{\\phi}_m \\left( \\frac{h_c - d}{l_m /\\beta} \\right)\\right] \\exp (0.5c_2) \\end{eqnarray}\\] In order to compute \\(c_1\\) from the above equation, an expression of \\(\\hat{\\phi}_m\\) at \\(z = h_c\\) is needed, which is obtained using equation \\eqref{eqn_phi_m} at \\(z = h_c\\) and equation \\eqref{eqn_phi_m_at_hc} as \\[\\begin{equation} \\hat{\\phi}_m \\left( \\frac{h_c-d}{l_m/\\beta}\\right) = \\frac{\\kappa}{2\\beta} \\phi_m^{-1} \\left( \\frac{h_c-d}{L_{MO}}\\right) \\end{equation}\\] Wind beta term The critical unknown in the roughness sublayer parameterization is \\(\\beta\\) . HF-2007 derived an expression for \\(\\beta\\) as \\[\\begin{equation} \\beta \\phi_m \\left( \\frac{h_c - d}{L_{MO}} \\right) = \\beta_N \\end{equation}\\] or \\[\\begin{equation} \\label{eqn_beta} \\beta \\phi_m \\left( \\frac{\\beta^3 L_c}{L_{MO}} \\right) = \\beta_N \\end{equation}\\] The solution of equation \\eqref{eqn_beta} depends on if \\(\\phi\\) is evaluated for unstable or stable condition and leads to following equations \\[\\begin{eqnarray} (\\beta^2)^2 + 16 \\frac{L_c}{L_{MO}}\\beta^4\\beta^2 - \\beta_N^4 &=& 0 L_{MO} < 0 \\\\ 5 \\frac{L_c}{L_{MO}} \\beta^3 + \\beta - \\beta_N &=& 0 L_{MO} \\geq 0 \\end{eqnarray}\\] The correct solution is the larger root for the sable condition, while the unstable case has only one real root. Temperature profile Similar to the equations for wind profiles, the equations describing profiles of heat (or scalar) above and within the canopy are given below. \\[\\begin{eqnarray} \\label{eqn_theta_du_dz_1} \\frac{\\kappa (z-d)}{\\theta_*}\\frac{\\partial \\theta}{\\partial z} &=& \\Phi_c\\left( z \\right) \\\\ \\Phi_c(z) &=& \\phi_c \\left( \\frac{z-d}{L_{MO}}\\right) \\hat{\\phi}_c \\left( \\frac{z-d}{l_m /\\beta }\\right) \\\\ \\theta(z) - \\theta_s &=& \\frac{\\theta_*}{\\kappa} \\left[ \\ln \\left( \\frac{z - d}{z_{0c}} \\right) - \\psi_m\\left( \\frac{z - d}{L_{MO}} \\right) + \\psi_m\\left( \\frac{z_{0c}}{L_{MO}} \\right) + \\hat{\\psi}_c(z) \\right] \\end{eqnarray}\\] where \\[\\begin{equation} \\hat{\\psi}_c = \\int_z^\\infty \\phi_c \\left( \\frac{z' - d}{L_{MO}} \\right) \\left[ 1 - \\hat{\\phi}_c \\left(\\frac{z' -d }{l_m/\\beta} \\right) \\right] \\frac{dz'}{z' - d} \\end{equation}\\] An exponential profile of air temperature is assumed within the canopy that is given by \\begin{equation} \\theta(z) - \\theta_s = (\\theta(h_c) - \\theta_s) \\exp\\left[ \\frac{f(z - h_c)}{l_m/\\beta} \\right] \\end{equation} where parameter \\(f\\) relates the length scale of heat (scalar) to that of momentum and is given by \\[\\begin{equation} f = \\frac{1}{2} (1 + 4r_c\\text{Pr})^{1/2} - \\frac{1}{2} \\end{equation}\\] and \\[\\begin{equation} \\text{Pr} = 0.5 + 0.3\\tanh(2L_c/L_{MO}) \\end{equation}\\] The derivatives of the profile within the canopy is \\[\\begin{equation} \\label{eqn_theta_du_dz_2} \\frac{\\partial \\theta (z)}{\\partial z} = \\frac{(\\theta(h_c) - \\theta_s) f}{l_m/\\beta}\\exp\\left[ \\frac{f(z - h_c)}{l_m/\\beta} \\right] \\end{equation}\\] Enforcing continuity of derivative at \\(z = h_c\\) using equation \\eqref{eqn_theta_du_dz_1} and \\eqref{eqn_theta_du_dz_2} \\[\\begin{equation} \\left. \\frac{\\partial \\theta}{\\partial z}\\right|_{z=h_c} = \\frac{\\theta_*}{\\kappa (h_c - d)}\\Phi_c(h_c) = \\frac{f[\\theta(h_c) -\\theta_s]}{l_m/\\beta} \\end{equation}\\] so that \\[\\begin{equation} \\frac{\\theta(h_c) - \\theta_s}{\\theta_*} = \\frac{\\text{Pr}}{f\\beta} \\end{equation}\\] An equation similar to equation \\eqref{eqn_u_with_hc} can be written for \\(\\theta\\) \\[\\begin{eqnarray} \\theta(z) - \\theta_s &=& \\frac{\\theta_*}{\\kappa} \\left[ \\ln \\left( \\frac{z - d}{h_c - d} \\right) - \\psi_c\\left( \\frac{z - d}{L_{MO}} \\right) + \\psi_c\\left( \\frac{h_c - d}{L_{MO}} \\right) \\right. \\nonumber \\\\ \\label{eqn_q_with_hc} & & \\left. + \\hat{\\psi_c}(z) - \\hat{\\psi_c}(h_c) + \\frac{\\kappa\\text{Pr}}{f\\beta} \\right] \\end{eqnarray}\\] For the above canopy wind profile, HF-2007 assumed the similarity function for momentum to be \\[\\begin{equation} \\hat{\\phi}_c \\left( \\frac{z-d}{l_m /\\beta} \\right) = 1 - c_1 \\exp \\left[ -c_2 \\left( \\frac{z-d}{l_m/\\beta} \\right)\\right] \\end{equation}\\] \\[\\begin{eqnarray} c_1 &=& \\left[ 1 - \\hat{\\phi}_c \\left( \\frac{h_c - d}{l_m /\\beta} \\right)\\right] \\exp (0.5c_2) \\\\ \\hat{\\phi}_c \\left( \\frac{z-d}{l_m/\\beta}\\right) &=& \\frac{\\kappa \\text{Pr}}{2\\beta} \\phi_c^{-1} \\left( \\frac{z-d}{L_{MO}}\\right) \\end{eqnarray}\\] Aerodynamic conductance The aerodynamic conductances for scalar, \\(g_{ac}\\) , is given as \\[\\begin{equation} \\frac{1}{g_{ac}} = \\int_{z_1}^{z_2} \\frac{dz}{\\rho_m K_c} \\end{equation}\\] where \\(K_c\\) is the eddy diffusivity for scalar based on K-theory. The aerodynamic conductance above canopy is \\begin{equation} g_{am,i+1/2} = \\rho_m \\kappa^2 u_* \\left[ \\ln \\left( \\frac{z_{i+1} - d}{z_i - d} \\right) + \\psi_{i+1} - \\psi_i \\right]^{-1} \\end{equation} where \\[\\begin{equation} \\psi_i = - \\psi_c\\left( \\frac{z_i - d}{L_{MO}} \\right) + \\psi_c\\left( \\frac{h_c - d}{L_{MO}} \\right) + \\hat{\\psi_c}(z_i) - \\hat{\\psi_c}(h_c) \\end{equation}\\] The aerodynamic conductance within canopy is \\[\\begin{equation} g_{ac,i+1/2} = \\frac{\\rho \\beta u_*}{\\text{Pr}} \\left[ \\exp \\left( \\frac{-(z_{i+1}-h_c)}{l_m/\\beta} \\right) - \\left( \\frac{-(z_i-h_c)}{l_m/\\beta} \\right) \\right]^{-1} \\end{equation}\\]","title":"Roughness sublayer model"},{"location":"tech_guide/mlc/roughness_sublayer_model/#wind-profile-above-canopy","text":"The wind profile, \\(u\\) , above canopy the is given as \\[\\begin{equation} \\label{eqn_du_dz_above} \\frac{\\kappa (z-d)}{u_* }\\frac{\\partial u }{\\partial z} = \\Phi_m\\left( z \\right) \\end{equation}\\] where \\(\\Phi_m\\) [-] is an effective similarity function that is given by \\[\\begin{equation} \\label{eqn_phi_m} \\Phi_m(z) = \\phi_m \\left( \\frac{z-d}{L_{MO}}\\right) \\hat{\\phi}_m \\left( \\frac{z-d}{l_m /\\beta }\\right) \\end{equation}\\] \\[\\begin{equation} u(z) = \\frac{u_*}{\\kappa} \\left[ \\ln \\left( \\frac{z - d}{z_{0m}} \\right) - \\psi_m\\left( \\frac{z - d}{L_{MO}} \\right) + \\psi_m\\left( \\frac{z_{0m}}{L_{MO}} \\right) + \\hat{\\psi}_m(z) \\right] \\end{equation}\\] where \\[\\begin{equation} \\label{eqn:wind_profile_rsl_above} \\hat{\\psi}_m = \\int_z^\\infty \\phi_m \\left( \\frac{z' - d}{L_{MO}} \\right) \\left[ 1 - \\hat{\\phi}_m \\left(\\frac{z' -d }{l_m/\\beta} \\right) \\right] \\frac{dz'}{z' - d} \\end{equation}\\] Given equation \\eqref{eqn:wind_profile_rsl_above}, the wind at canopy height is given by \\[\\begin{equation} \\label{eqn:wind_at_hc} u_{hc} = \\frac{u_*}{\\beta} \\end{equation}\\] \\[\\begin{eqnarray} u(z) &=& \\frac{u_*}{\\kappa} \\left[ \\ln \\left( \\frac{z - d}{h_c - d} \\right) - \\psi_m\\left( \\frac{z - d}{L_{MO}} \\right) + \\psi_m\\left( \\frac{h_c - d}{L_{MO}} \\right) \\right. \\nonumber \\\\ & & \\label{eqn_u_with_hc} \\left. + \\hat{\\psi_m}(z) - \\hat{\\psi_m}(h_c) + \\frac{\\kappa}{\\beta} \\right] \\end{eqnarray}\\]","title":"Wind profile above canopy"},{"location":"tech_guide/mlc/roughness_sublayer_model/#wind-profile-within-canopy","text":"HF-2007 assumed an exponential wind profile within the canopy that is given as \\[\\begin{equation} \\label{eqn_du_dz_within} u(z) = u(h_c)\\exp\\left( \\frac{z - h_c}{l_m/\\beta} \\right) \\end{equation}\\] and the derivative of the wind profile is \\[\\begin{eqnarray} \\frac{\\partial u(z)}{\\partial z} &=& \\frac{u(h_c)}{l_m/\\beta} \\exp\\left( \\frac{z - h_c}{l_m/\\beta} \\right) \\nonumber \\\\ &=& \\frac{u(z)}{l_m/\\beta} \\end{eqnarray}\\] \\[\\begin{equation} h_c - d = \\frac{l_m}{2\\beta} = \\beta^2 L_c \\end{equation}\\] Enforcing the continuity of derivative of wind at canopy height ( \\(h_c\\) ) from equation \\eqref{eqn_du_dz_above} and \\eqref{eqn_du_dz_within} leads to \\[\\begin{eqnarray} \\frac{u_*}{\\kappa (h_c - d)} \\Phi_m(h_c) &=& \\frac{u(h_c)}{l_m/\\beta} \\nonumber \\\\ \\Phi_m(h_c) &=& \\frac{u(h_c)}{u_*} \\times \\frac{\\kappa (h_c - d)}{l_m/\\beta} \\nonumber \\\\ \\Phi_m(h_c) &=& \\frac{1}{\\beta} \\times \\frac{\\kappa l_m/(2\\beta) }{l_m/\\beta} \\nonumber \\\\ \\label{eqn_phi_m_at_hc} \\Phi_m(h_c) &=& \\frac{\\kappa l_m}{2\\beta} \\end{eqnarray}\\]","title":"Wind profile within canopy"},{"location":"tech_guide/mlc/roughness_sublayer_model/#wind-similarity-function","text":"For the above canopy wind profile, HF-2007 assumed the similarity function for momentum to be \\[\\begin{equation} \\hat{\\phi}_m \\left( \\frac{z-d}{l_m /\\beta} \\right) = 1 - c_1 \\exp \\left[ -c_2 \\left( \\frac{z-d}{l_m/\\beta} \\right)\\right] \\end{equation}\\] where \\(c_1\\) and \\(c_2 (= 0.5)\\) are parameters. The parameter \\(c_1\\) is found by evaluating \\(\\hat{\\phi}_m\\) at \\(z=h_c\\) that gives \\[\\begin{eqnarray} \\hat{\\phi}_m \\left( \\frac{h_c - d}{l_m /\\beta} \\right) &=& 1 - c_1 \\exp \\left[ -c_2 \\left( \\frac{h_c-d}{l_m/\\beta} \\right)\\right] \\nonumber \\\\ &=& 1 - c_1 \\exp \\left[ -c_2 \\left( \\frac{l_m/(2\\beta)}{l_m/\\beta} \\right)\\right] \\nonumber \\\\ &=& 1 - c_1 \\exp \\left( -0.5c_2\\right) \\nonumber \\\\ c_1 &=& \\left[ 1 - \\hat{\\phi}_m \\left( \\frac{h_c - d}{l_m /\\beta} \\right)\\right] \\exp (0.5c_2) \\end{eqnarray}\\] In order to compute \\(c_1\\) from the above equation, an expression of \\(\\hat{\\phi}_m\\) at \\(z = h_c\\) is needed, which is obtained using equation \\eqref{eqn_phi_m} at \\(z = h_c\\) and equation \\eqref{eqn_phi_m_at_hc} as \\[\\begin{equation} \\hat{\\phi}_m \\left( \\frac{h_c-d}{l_m/\\beta}\\right) = \\frac{\\kappa}{2\\beta} \\phi_m^{-1} \\left( \\frac{h_c-d}{L_{MO}}\\right) \\end{equation}\\]","title":"Wind similarity function"},{"location":"tech_guide/mlc/roughness_sublayer_model/#wind-beta-term","text":"The critical unknown in the roughness sublayer parameterization is \\(\\beta\\) . HF-2007 derived an expression for \\(\\beta\\) as \\[\\begin{equation} \\beta \\phi_m \\left( \\frac{h_c - d}{L_{MO}} \\right) = \\beta_N \\end{equation}\\] or \\[\\begin{equation} \\label{eqn_beta} \\beta \\phi_m \\left( \\frac{\\beta^3 L_c}{L_{MO}} \\right) = \\beta_N \\end{equation}\\] The solution of equation \\eqref{eqn_beta} depends on if \\(\\phi\\) is evaluated for unstable or stable condition and leads to following equations \\[\\begin{eqnarray} (\\beta^2)^2 + 16 \\frac{L_c}{L_{MO}}\\beta^4\\beta^2 - \\beta_N^4 &=& 0 L_{MO} < 0 \\\\ 5 \\frac{L_c}{L_{MO}} \\beta^3 + \\beta - \\beta_N &=& 0 L_{MO} \\geq 0 \\end{eqnarray}\\] The correct solution is the larger root for the sable condition, while the unstable case has only one real root.","title":"Wind beta term"},{"location":"tech_guide/mlc/roughness_sublayer_model/#temperature-profile","text":"Similar to the equations for wind profiles, the equations describing profiles of heat (or scalar) above and within the canopy are given below. \\[\\begin{eqnarray} \\label{eqn_theta_du_dz_1} \\frac{\\kappa (z-d)}{\\theta_*}\\frac{\\partial \\theta}{\\partial z} &=& \\Phi_c\\left( z \\right) \\\\ \\Phi_c(z) &=& \\phi_c \\left( \\frac{z-d}{L_{MO}}\\right) \\hat{\\phi}_c \\left( \\frac{z-d}{l_m /\\beta }\\right) \\\\ \\theta(z) - \\theta_s &=& \\frac{\\theta_*}{\\kappa} \\left[ \\ln \\left( \\frac{z - d}{z_{0c}} \\right) - \\psi_m\\left( \\frac{z - d}{L_{MO}} \\right) + \\psi_m\\left( \\frac{z_{0c}}{L_{MO}} \\right) + \\hat{\\psi}_c(z) \\right] \\end{eqnarray}\\] where \\[\\begin{equation} \\hat{\\psi}_c = \\int_z^\\infty \\phi_c \\left( \\frac{z' - d}{L_{MO}} \\right) \\left[ 1 - \\hat{\\phi}_c \\left(\\frac{z' -d }{l_m/\\beta} \\right) \\right] \\frac{dz'}{z' - d} \\end{equation}\\] An exponential profile of air temperature is assumed within the canopy that is given by \\begin{equation} \\theta(z) - \\theta_s = (\\theta(h_c) - \\theta_s) \\exp\\left[ \\frac{f(z - h_c)}{l_m/\\beta} \\right] \\end{equation} where parameter \\(f\\) relates the length scale of heat (scalar) to that of momentum and is given by \\[\\begin{equation} f = \\frac{1}{2} (1 + 4r_c\\text{Pr})^{1/2} - \\frac{1}{2} \\end{equation}\\] and \\[\\begin{equation} \\text{Pr} = 0.5 + 0.3\\tanh(2L_c/L_{MO}) \\end{equation}\\] The derivatives of the profile within the canopy is \\[\\begin{equation} \\label{eqn_theta_du_dz_2} \\frac{\\partial \\theta (z)}{\\partial z} = \\frac{(\\theta(h_c) - \\theta_s) f}{l_m/\\beta}\\exp\\left[ \\frac{f(z - h_c)}{l_m/\\beta} \\right] \\end{equation}\\] Enforcing continuity of derivative at \\(z = h_c\\) using equation \\eqref{eqn_theta_du_dz_1} and \\eqref{eqn_theta_du_dz_2} \\[\\begin{equation} \\left. \\frac{\\partial \\theta}{\\partial z}\\right|_{z=h_c} = \\frac{\\theta_*}{\\kappa (h_c - d)}\\Phi_c(h_c) = \\frac{f[\\theta(h_c) -\\theta_s]}{l_m/\\beta} \\end{equation}\\] so that \\[\\begin{equation} \\frac{\\theta(h_c) - \\theta_s}{\\theta_*} = \\frac{\\text{Pr}}{f\\beta} \\end{equation}\\] An equation similar to equation \\eqref{eqn_u_with_hc} can be written for \\(\\theta\\) \\[\\begin{eqnarray} \\theta(z) - \\theta_s &=& \\frac{\\theta_*}{\\kappa} \\left[ \\ln \\left( \\frac{z - d}{h_c - d} \\right) - \\psi_c\\left( \\frac{z - d}{L_{MO}} \\right) + \\psi_c\\left( \\frac{h_c - d}{L_{MO}} \\right) \\right. \\nonumber \\\\ \\label{eqn_q_with_hc} & & \\left. + \\hat{\\psi_c}(z) - \\hat{\\psi_c}(h_c) + \\frac{\\kappa\\text{Pr}}{f\\beta} \\right] \\end{eqnarray}\\] For the above canopy wind profile, HF-2007 assumed the similarity function for momentum to be \\[\\begin{equation} \\hat{\\phi}_c \\left( \\frac{z-d}{l_m /\\beta} \\right) = 1 - c_1 \\exp \\left[ -c_2 \\left( \\frac{z-d}{l_m/\\beta} \\right)\\right] \\end{equation}\\] \\[\\begin{eqnarray} c_1 &=& \\left[ 1 - \\hat{\\phi}_c \\left( \\frac{h_c - d}{l_m /\\beta} \\right)\\right] \\exp (0.5c_2) \\\\ \\hat{\\phi}_c \\left( \\frac{z-d}{l_m/\\beta}\\right) &=& \\frac{\\kappa \\text{Pr}}{2\\beta} \\phi_c^{-1} \\left( \\frac{z-d}{L_{MO}}\\right) \\end{eqnarray}\\]","title":"Temperature profile"},{"location":"tech_guide/mlc/roughness_sublayer_model/#aerodynamic-conductance","text":"The aerodynamic conductances for scalar, \\(g_{ac}\\) , is given as \\[\\begin{equation} \\frac{1}{g_{ac}} = \\int_{z_1}^{z_2} \\frac{dz}{\\rho_m K_c} \\end{equation}\\] where \\(K_c\\) is the eddy diffusivity for scalar based on K-theory. The aerodynamic conductance above canopy is \\begin{equation} g_{am,i+1/2} = \\rho_m \\kappa^2 u_* \\left[ \\ln \\left( \\frac{z_{i+1} - d}{z_i - d} \\right) + \\psi_{i+1} - \\psi_i \\right]^{-1} \\end{equation} where \\[\\begin{equation} \\psi_i = - \\psi_c\\left( \\frac{z_i - d}{L_{MO}} \\right) + \\psi_c\\left( \\frac{h_c - d}{L_{MO}} \\right) + \\hat{\\psi_c}(z_i) - \\hat{\\psi_c}(h_c) \\end{equation}\\] The aerodynamic conductance within canopy is \\[\\begin{equation} g_{ac,i+1/2} = \\frac{\\rho \\beta u_*}{\\text{Pr}} \\left[ \\exp \\left( \\frac{-(z_{i+1}-h_c)}{l_m/\\beta} \\right) - \\left( \\frac{-(z_i-h_c)}{l_m/\\beta} \\right) \\right]^{-1} \\end{equation}\\]","title":"Aerodynamic conductance"},{"location":"tech_guide/mlc/shortwave_radiation/","text":"Governing equations The downwelling, \\(I_i^{\\downarrow}\\) [Wm \\(^{-2}\\) ], and upwelling, \\(I_{i+1}^{\\uparrow}\\) [Wm \\(^{-2}\\) ], scattered radiation fluxes at \\(i\\) -th and \\((i+1)\\) -th level are given as \\[\\begin{eqnarray} I_{i }^{\\downarrow} & = & I_{i+1 }^{\\downarrow} \\left[ \\mathcal{\\tau}_{d,i+1} + (1 - \\tau_{d,i+1})\\tau_{\\ell,i+1}\\right] + I_{i }^{\\uparrow} (1 - \\tau_{d,i+1})\\rho_{\\ell,i+1} \\nonumber \\\\ \\label{eqn_sw_dn} & & + I_{sky,b}^{\\downarrow} T_{b,i+1} (1 - \\tau_{b,i+1})\\tau_{\\ell,i+1} \\\\ I_{i+1}^{\\uparrow} & = & I_{i }^{\\uparrow} \\left[ \\tau_{d,i+1} + (1 - \\tau_{d,i+1})\\tau_{\\ell,i+1}\\right] + I_{i+1 }^{\\downarrow} (1 - \\tau_{d,i+1})\\rho_{\\ell,i+1} \\nonumber \\\\ & & + I_{sky,b}^{\\downarrow} T_{b,i+1} (1 - \\tau_{b,i+1})\\rho_{\\ell,i+1} \\label{eqn_sw_up} \\end{eqnarray}\\] where \\(\\tau_{d,i+1}\\) [-] and \\(\\tau_{b,i+1}\\) [-] are the diffuse and direct beam transmittances through \\((i+1)\\) -th layer, \\(\\rho_{\\ell,i+1}\\) [-] is the leaf reflectance of \\((i+1)\\) -th layer, \\(I_{sky,b}\\) [Wm \\(^{-2}\\) ] is the direct beam radiation incident on the top of the canopy, and \\(T_{b,i+1}\\) [-] is the fraction of direct beam radiation that is not intercepted through the cumulative leaf area above the \\((i+1)\\) -th layer. Transmittance The direct beam transmittance through the \\((i+1)\\) -th layer with leaf area index \\(\\Delta L_{i+1}\\) is \\[\\begin{equation} \\tau_{d,i+1} = 2 \\int_{0}^{\\pi/2} \\exp \\left[ - \\frac{G(Z_i)\\Omega}{\\cos (Z_i)} \\Delta L_{i+1} \\right] \\sin (Z_i) \\cos (Z_i) dZ \\end{equation}\\] where \\(Z\\) is the sky zenith angle and \\(\\Omega\\) is the leaf clumping factor. The Ross-Goudriann function, \\(G(Z)\\) , is given by \\begin{equation} \\label{eqn_rg_function} G(Z) = \\phi_1 + \\phi_2 \\cos(Z) \\end{equation} where \\(\\phi_1 = 0.5 -0.633\\chi_\\ell - 0.33\\chi_\\ell^2\\) and \\(\\phi_2 = 0.877 (1 - 2\\phi_1\\) ). The leaf departure angle from from spherical orientation, \\(\\chi_\\ell\\) , in restricted to \\(-0.4 \\le \\chi_\\ell \\le 0.6\\) . The equation \\eqref{eqn_rg_function} is numerically approximation for nine sky zones as \\begin{equation} \\tau_{d,i+1} = 2 \\sum_{i=1}^{9} \\exp \\left[ - \\frac{G(Z_i)\\Omega}{\\cos (Z_i)} \\Delta L_{i+1} \\right] \\sin (Z_i) \\cos (Z_i) \\Delta Z_i \\end{equation} with \\(\\Delta Z_i = \\pi/18\\) . The diffuse beam transmittance through the \\((i+1)\\) -th layer is \\begin{equation} \\tau_{b,i+1} = \\exp \\left( -K_{b,i+1} \\Omega \\Delta L_{i+1} \\right) \\end{equation} % where \\(K_{b,i+1} = G(Z)/\\cos(Z)\\) is the extinction coefficient for the direct beam. The fraction of direct been that is not intercepted through the cumulative leaf area above the \\((i+1)\\) -th layer is computed as \\[\\begin{equation} T_{b,i+1} = \\prod_{j=i+1}^N \\exp \\left( -K_{b,j} \\Omega_j \\Delta L_j \\right) \\end{equation}\\] Linear system The equation \\eqref{eqn_sw_dn}-\\eqref{eqn_sw_up} can be written as a system of linear equations \\[\\begin{eqnarray} \\label{eqn_sw_linear_system_up} -a_i I_i^{\\uparrow} + I_i^\\downarrow - b_iI_{i+1}^\\uparrow &=& d_i \\\\ \\label{eqn_sw_linear_system_dn} -e_{i+1}I_i^\\downarrow + I_{i+1}^\\uparrow - f_{i+1}I_{i+1}^\\downarrow &=& c_{i+1} \\end{eqnarray}\\] where \\[\\begin{eqnarray} a_i &=& f_{i+1} = (1-\\tau_{d,i+1})\\rho_{\\ell,i+1} - \\frac{[\\tau_{d,i+1} + (1 - \\tau_{d,i+1}) \\tau_{\\ell,i+1} ]^2} {(1 - \\tau_{d,i+1})/\\rho_{\\ell,i+1}} \\\\ b_i &=& e_{i+1} = \\frac{\\tau_{d,i+1} + (1 - \\tau_{d,i+1})\\tau_{\\ell,i+1}} {(1 - \\tau_{d,i+1}) \\rho_{\\ell,i+1}} \\\\ c_i &=& I_{sky,b}^\\downarrow T_{b,i } (1 - \\tau_{b,i }) (\\rho_{\\ell,i } - \\tau_{\\ell,i. } e_i)\\\\ d_i &=& I_{sky,b}^\\downarrow T_{b,i+1} (1 - \\tau_{b,i+1}) (\\tau_{\\ell,i+1} - \\rho_{\\ell,i+1} b_i) \\end{eqnarray}\\] The boundary conditions for the downwelling radiation at the bottom layer, \\(i=0\\) , and the upwelling radiation at the top layer, \\(i=N\\) , are given by \\[\\begin{eqnarray} c_0 &=& \\rho_{gb} I_{sky,b}^\\downarrow T_{b,0} \\\\ f_0 &=& \\rho_{gd} \\\\ d_N &=& I_{sky,d}^\\downarrow \\end{eqnarray}\\] where \\(\\rho_{gb}\\) [-] is the surface albedo for beam radiation, \\(\\rho_{gd}\\) [-] is the surface albedo for diffuse radiation, and \\(I_{sky,d}\\) [Wm \\(^{-2}\\) ] is the diffuse radiation incident on the top of the canopy. The linear system of equations given in equation \\eqref{eqn_sw_linear_system_up}-\\eqref{eqn_sw_linear_system_dn} can be written as \\[\\begin{align} \\begin{bmatrix} 1 & -\\rho_{gd} & & & & & & \\\\[.6em] -a_0 & 1 & -b_0 & & & & & \\\\[.6em] & -e_1 & 1 & -f_1 & & & & \\\\[.6em] & & -a_1 & 1 & -b_1 & & & \\\\[.6em] & & & \\ddots & \\ddots & \\ddots & & \\\\[.6em] & & & & \\ddots & \\ddots & \\ddots & \\\\[.6em] & & & & & -e_N & 1 & -f_N \\\\[.6em] & & & & & & 0 & 1 \\end{bmatrix} \\begin{bmatrix} \\hspace{5pt} I_0^\\uparrow \\hspace{5pt} \\\\[.5em] I_0^\\downarrow \\\\[.5em] I_1^\\uparrow \\\\[.5em] I_1^\\downarrow \\\\[.5em] \\vdots \\\\[.5em] \\vdots \\\\[.5em] I_N^\\uparrow \\\\[.5em] I_N^\\downarrow \\end{bmatrix} = \\begin{bmatrix} \\hspace{5pt} c_0 \\hspace{5pt} \\\\[.6em] d_0 \\\\[.6em] c_1 \\\\[.6em] d_1 \\\\[.6em] \\vdots \\\\[.6em] \\vdots \\\\[.6em] c_N \\\\[.6em] d_N \\end{bmatrix} \\end{align}\\] Absorbed radiative fluxes The diffuse, \\(\\overrightarrow{I}_{cd,i}\\) [Wm \\(_{ground}^{-2}\\) ], and direct beam, \\(\\overrightarrow{I}_{cb,i}\\) [Wm \\(_{ground}^{-2}\\) ], radiation absorbed by the \\(i\\) -th canopy layer is \\[\\begin{eqnarray} \\overrightarrow{I}_{cd,i} &=& \\left( I_i^\\downarrow + I_{i-1}^\\uparrow \\right) (1 - \\tau_{d,i})(1 - \\omega_{\\ell,i}) \\\\ \\overrightarrow{I}_{cb,i} &=& I_{sky,b}^\\downarrow T_{b,i}(1 - \\tau_{b,i})(1 - \\omega_{\\ell,i}) \\end{eqnarray}\\] The radiation absorbed at the ground, \\(\\overrightarrow{I}_{g}\\) [Wm \\(_{ground}^{-2}\\) ], is \\[\\begin{equation} \\overrightarrow{I}_g = \\left( 1 - \\rho_{gd} \\right) I_0^\\downarrow + \\left( 1 - \\rho_{gb} \\right) I_{sky,b}^\\downarrow T_{b,0} \\end{equation}\\] It is assumed that the shaded leaves only absorb diffuse radiation, while sunlit leaves receive direct and diffuse radiations. The absorbed radiation fluxes by shaded, \\(\\overrightarrow{I}_{\\ell sha, i}\\) [Wm \\(_{leaf}^{-2}\\) ], and sunlit, \\(\\overrightarrow{I}_{\\ell sun, i}\\) [Wm \\(_{leaf}^{-2}\\) ], is given as \\[\\begin{eqnarray} \\overrightarrow{I}_{\\ell sha, i} &=& \\frac{I_{cd,i}}{\\Delta L_i} \\\\[0.5em] \\overrightarrow{I}_{\\ell sun, i} &=& \\overrightarrow{I}_{\\ell sha, i} + \\frac{\\overrightarrow{I}_{cb,i}}{f_{sun,i} \\Delta L_i} \\end{eqnarray}\\] where \\(f_{sun}\\) [-] is the fraction of sunlit leaves at \\(i\\) -th layer. The absorbed canopy fluxes for shaded, \\(\\overrightarrow{I}_{cSha}\\) [Wm \\(_{ground}^{-2}\\) ], and sunlit, \\(\\overrightarrow{I}_{cSun}\\) [Wm \\(_{ground}^{-2}\\) ], are \\[\\begin{eqnarray} \\overrightarrow{I}_{cSha} &=& \\sum_{i=1}^N \\overrightarrow{I}_{\\ell sha, i} ( 1 - f_{sun}) \\Delta L_i = \\sum_{i=1}^N I_{cd,i} (1 - f_{sun})\\\\ \\overrightarrow{I}_{cSun} &=& \\sum_{i=1}^N \\overrightarrow{I}_{\\ell sun, i} f_{sun} \\Delta L_i = \\sum_{i=1}^N \\left( \\overrightarrow{I}_{cd, i} f_{sun} + \\overrightarrow{I}_{cb,i}\\right) \\end{eqnarray}\\]","title":"Shortwave radiation"},{"location":"tech_guide/mlc/shortwave_radiation/#governing-equations","text":"The downwelling, \\(I_i^{\\downarrow}\\) [Wm \\(^{-2}\\) ], and upwelling, \\(I_{i+1}^{\\uparrow}\\) [Wm \\(^{-2}\\) ], scattered radiation fluxes at \\(i\\) -th and \\((i+1)\\) -th level are given as \\[\\begin{eqnarray} I_{i }^{\\downarrow} & = & I_{i+1 }^{\\downarrow} \\left[ \\mathcal{\\tau}_{d,i+1} + (1 - \\tau_{d,i+1})\\tau_{\\ell,i+1}\\right] + I_{i }^{\\uparrow} (1 - \\tau_{d,i+1})\\rho_{\\ell,i+1} \\nonumber \\\\ \\label{eqn_sw_dn} & & + I_{sky,b}^{\\downarrow} T_{b,i+1} (1 - \\tau_{b,i+1})\\tau_{\\ell,i+1} \\\\ I_{i+1}^{\\uparrow} & = & I_{i }^{\\uparrow} \\left[ \\tau_{d,i+1} + (1 - \\tau_{d,i+1})\\tau_{\\ell,i+1}\\right] + I_{i+1 }^{\\downarrow} (1 - \\tau_{d,i+1})\\rho_{\\ell,i+1} \\nonumber \\\\ & & + I_{sky,b}^{\\downarrow} T_{b,i+1} (1 - \\tau_{b,i+1})\\rho_{\\ell,i+1} \\label{eqn_sw_up} \\end{eqnarray}\\] where \\(\\tau_{d,i+1}\\) [-] and \\(\\tau_{b,i+1}\\) [-] are the diffuse and direct beam transmittances through \\((i+1)\\) -th layer, \\(\\rho_{\\ell,i+1}\\) [-] is the leaf reflectance of \\((i+1)\\) -th layer, \\(I_{sky,b}\\) [Wm \\(^{-2}\\) ] is the direct beam radiation incident on the top of the canopy, and \\(T_{b,i+1}\\) [-] is the fraction of direct beam radiation that is not intercepted through the cumulative leaf area above the \\((i+1)\\) -th layer.","title":"Governing equations"},{"location":"tech_guide/mlc/shortwave_radiation/#transmittance","text":"The direct beam transmittance through the \\((i+1)\\) -th layer with leaf area index \\(\\Delta L_{i+1}\\) is \\[\\begin{equation} \\tau_{d,i+1} = 2 \\int_{0}^{\\pi/2} \\exp \\left[ - \\frac{G(Z_i)\\Omega}{\\cos (Z_i)} \\Delta L_{i+1} \\right] \\sin (Z_i) \\cos (Z_i) dZ \\end{equation}\\] where \\(Z\\) is the sky zenith angle and \\(\\Omega\\) is the leaf clumping factor. The Ross-Goudriann function, \\(G(Z)\\) , is given by \\begin{equation} \\label{eqn_rg_function} G(Z) = \\phi_1 + \\phi_2 \\cos(Z) \\end{equation} where \\(\\phi_1 = 0.5 -0.633\\chi_\\ell - 0.33\\chi_\\ell^2\\) and \\(\\phi_2 = 0.877 (1 - 2\\phi_1\\) ). The leaf departure angle from from spherical orientation, \\(\\chi_\\ell\\) , in restricted to \\(-0.4 \\le \\chi_\\ell \\le 0.6\\) . The equation \\eqref{eqn_rg_function} is numerically approximation for nine sky zones as \\begin{equation} \\tau_{d,i+1} = 2 \\sum_{i=1}^{9} \\exp \\left[ - \\frac{G(Z_i)\\Omega}{\\cos (Z_i)} \\Delta L_{i+1} \\right] \\sin (Z_i) \\cos (Z_i) \\Delta Z_i \\end{equation} with \\(\\Delta Z_i = \\pi/18\\) . The diffuse beam transmittance through the \\((i+1)\\) -th layer is \\begin{equation} \\tau_{b,i+1} = \\exp \\left( -K_{b,i+1} \\Omega \\Delta L_{i+1} \\right) \\end{equation} % where \\(K_{b,i+1} = G(Z)/\\cos(Z)\\) is the extinction coefficient for the direct beam. The fraction of direct been that is not intercepted through the cumulative leaf area above the \\((i+1)\\) -th layer is computed as \\[\\begin{equation} T_{b,i+1} = \\prod_{j=i+1}^N \\exp \\left( -K_{b,j} \\Omega_j \\Delta L_j \\right) \\end{equation}\\]","title":"Transmittance"},{"location":"tech_guide/mlc/shortwave_radiation/#linear-system","text":"The equation \\eqref{eqn_sw_dn}-\\eqref{eqn_sw_up} can be written as a system of linear equations \\[\\begin{eqnarray} \\label{eqn_sw_linear_system_up} -a_i I_i^{\\uparrow} + I_i^\\downarrow - b_iI_{i+1}^\\uparrow &=& d_i \\\\ \\label{eqn_sw_linear_system_dn} -e_{i+1}I_i^\\downarrow + I_{i+1}^\\uparrow - f_{i+1}I_{i+1}^\\downarrow &=& c_{i+1} \\end{eqnarray}\\] where \\[\\begin{eqnarray} a_i &=& f_{i+1} = (1-\\tau_{d,i+1})\\rho_{\\ell,i+1} - \\frac{[\\tau_{d,i+1} + (1 - \\tau_{d,i+1}) \\tau_{\\ell,i+1} ]^2} {(1 - \\tau_{d,i+1})/\\rho_{\\ell,i+1}} \\\\ b_i &=& e_{i+1} = \\frac{\\tau_{d,i+1} + (1 - \\tau_{d,i+1})\\tau_{\\ell,i+1}} {(1 - \\tau_{d,i+1}) \\rho_{\\ell,i+1}} \\\\ c_i &=& I_{sky,b}^\\downarrow T_{b,i } (1 - \\tau_{b,i }) (\\rho_{\\ell,i } - \\tau_{\\ell,i. } e_i)\\\\ d_i &=& I_{sky,b}^\\downarrow T_{b,i+1} (1 - \\tau_{b,i+1}) (\\tau_{\\ell,i+1} - \\rho_{\\ell,i+1} b_i) \\end{eqnarray}\\] The boundary conditions for the downwelling radiation at the bottom layer, \\(i=0\\) , and the upwelling radiation at the top layer, \\(i=N\\) , are given by \\[\\begin{eqnarray} c_0 &=& \\rho_{gb} I_{sky,b}^\\downarrow T_{b,0} \\\\ f_0 &=& \\rho_{gd} \\\\ d_N &=& I_{sky,d}^\\downarrow \\end{eqnarray}\\] where \\(\\rho_{gb}\\) [-] is the surface albedo for beam radiation, \\(\\rho_{gd}\\) [-] is the surface albedo for diffuse radiation, and \\(I_{sky,d}\\) [Wm \\(^{-2}\\) ] is the diffuse radiation incident on the top of the canopy. The linear system of equations given in equation \\eqref{eqn_sw_linear_system_up}-\\eqref{eqn_sw_linear_system_dn} can be written as \\[\\begin{align} \\begin{bmatrix} 1 & -\\rho_{gd} & & & & & & \\\\[.6em] -a_0 & 1 & -b_0 & & & & & \\\\[.6em] & -e_1 & 1 & -f_1 & & & & \\\\[.6em] & & -a_1 & 1 & -b_1 & & & \\\\[.6em] & & & \\ddots & \\ddots & \\ddots & & \\\\[.6em] & & & & \\ddots & \\ddots & \\ddots & \\\\[.6em] & & & & & -e_N & 1 & -f_N \\\\[.6em] & & & & & & 0 & 1 \\end{bmatrix} \\begin{bmatrix} \\hspace{5pt} I_0^\\uparrow \\hspace{5pt} \\\\[.5em] I_0^\\downarrow \\\\[.5em] I_1^\\uparrow \\\\[.5em] I_1^\\downarrow \\\\[.5em] \\vdots \\\\[.5em] \\vdots \\\\[.5em] I_N^\\uparrow \\\\[.5em] I_N^\\downarrow \\end{bmatrix} = \\begin{bmatrix} \\hspace{5pt} c_0 \\hspace{5pt} \\\\[.6em] d_0 \\\\[.6em] c_1 \\\\[.6em] d_1 \\\\[.6em] \\vdots \\\\[.6em] \\vdots \\\\[.6em] c_N \\\\[.6em] d_N \\end{bmatrix} \\end{align}\\]","title":"Linear system"},{"location":"tech_guide/mlc/shortwave_radiation/#absorbed-radiative-fluxes","text":"The diffuse, \\(\\overrightarrow{I}_{cd,i}\\) [Wm \\(_{ground}^{-2}\\) ], and direct beam, \\(\\overrightarrow{I}_{cb,i}\\) [Wm \\(_{ground}^{-2}\\) ], radiation absorbed by the \\(i\\) -th canopy layer is \\[\\begin{eqnarray} \\overrightarrow{I}_{cd,i} &=& \\left( I_i^\\downarrow + I_{i-1}^\\uparrow \\right) (1 - \\tau_{d,i})(1 - \\omega_{\\ell,i}) \\\\ \\overrightarrow{I}_{cb,i} &=& I_{sky,b}^\\downarrow T_{b,i}(1 - \\tau_{b,i})(1 - \\omega_{\\ell,i}) \\end{eqnarray}\\] The radiation absorbed at the ground, \\(\\overrightarrow{I}_{g}\\) [Wm \\(_{ground}^{-2}\\) ], is \\[\\begin{equation} \\overrightarrow{I}_g = \\left( 1 - \\rho_{gd} \\right) I_0^\\downarrow + \\left( 1 - \\rho_{gb} \\right) I_{sky,b}^\\downarrow T_{b,0} \\end{equation}\\] It is assumed that the shaded leaves only absorb diffuse radiation, while sunlit leaves receive direct and diffuse radiations. The absorbed radiation fluxes by shaded, \\(\\overrightarrow{I}_{\\ell sha, i}\\) [Wm \\(_{leaf}^{-2}\\) ], and sunlit, \\(\\overrightarrow{I}_{\\ell sun, i}\\) [Wm \\(_{leaf}^{-2}\\) ], is given as \\[\\begin{eqnarray} \\overrightarrow{I}_{\\ell sha, i} &=& \\frac{I_{cd,i}}{\\Delta L_i} \\\\[0.5em] \\overrightarrow{I}_{\\ell sun, i} &=& \\overrightarrow{I}_{\\ell sha, i} + \\frac{\\overrightarrow{I}_{cb,i}}{f_{sun,i} \\Delta L_i} \\end{eqnarray}\\] where \\(f_{sun}\\) [-] is the fraction of sunlit leaves at \\(i\\) -th layer. The absorbed canopy fluxes for shaded, \\(\\overrightarrow{I}_{cSha}\\) [Wm \\(_{ground}^{-2}\\) ], and sunlit, \\(\\overrightarrow{I}_{cSun}\\) [Wm \\(_{ground}^{-2}\\) ], are \\[\\begin{eqnarray} \\overrightarrow{I}_{cSha} &=& \\sum_{i=1}^N \\overrightarrow{I}_{\\ell sha, i} ( 1 - f_{sun}) \\Delta L_i = \\sum_{i=1}^N I_{cd,i} (1 - f_{sun})\\\\ \\overrightarrow{I}_{cSun} &=& \\sum_{i=1}^N \\overrightarrow{I}_{\\ell sun, i} f_{sun} \\Delta L_i = \\sum_{i=1}^N \\left( \\overrightarrow{I}_{cd, i} f_{sun} + \\overrightarrow{I}_{cb,i}\\right) \\end{eqnarray}\\]","title":"Absorbed radiative fluxes"}]}